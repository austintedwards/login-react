<!DOCTYPE html>
<html>
<head>
  <title>_mocha</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/.bin/_mocha";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>_mocha</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>
<span class="hljs-meta">'use strict'</span>;

<span class="hljs-comment">/* eslint no-unused-vars: off */</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>Module dependencies.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> program = <span class="hljs-built_in">require</span>(<span class="hljs-string">'commander'</span>);
<span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">var</span> resolve = path.resolve;
<span class="hljs-keyword">var</span> exists = fs.existsSync || path.existsSync;
<span class="hljs-keyword">var</span> Mocha = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../'</span>);
<span class="hljs-keyword">var</span> utils = Mocha.utils;
<span class="hljs-keyword">var</span> interfaceNames = <span class="hljs-built_in">Object</span>.keys(Mocha.interfaces);
<span class="hljs-keyword">var</span> join = path.join;
<span class="hljs-keyword">var</span> cwd = process.cwd();
<span class="hljs-keyword">var</span> getOptions = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./options'</span>);
<span class="hljs-keyword">var</span> mocha = <span class="hljs-keyword">new</span> Mocha();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
<p>Save timer references to avoid Sinon interfering (see GH-237).</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> <span class="hljs-built_in">Date</span> = global.Date;
<span class="hljs-keyword">var</span> setTimeout = global.setTimeout;
<span class="hljs-keyword">var</span> setInterval = global.setInterval;
<span class="hljs-keyword">var</span> clearTimeout = global.clearTimeout;
<span class="hljs-keyword">var</span> clearInterval = global.clearInterval;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>Files.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> files = [];

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>Globals.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> globals = [];

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<div class="dox">
<div class="summary">
<p>Requires.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> requires = [];

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
<p>Images.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> images = {
  <span class="hljs-attr">fail</span>: path.join(__dirname, <span class="hljs-string">'..'</span>, <span class="hljs-string">'images'</span>, <span class="hljs-string">'error.png'</span>),
  <span class="hljs-attr">pass</span>: path.join(__dirname, <span class="hljs-string">'..'</span>, <span class="hljs-string">'images'</span>, <span class="hljs-string">'ok.png'</span>)
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>options</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
program
  .version(<span class="hljs-built_in">JSON</span>.parse(fs.readFileSync(path.join(__dirname, <span class="hljs-string">'..'</span>, <span class="hljs-string">'package.json'</span>), <span class="hljs-string">'utf8'</span>)).version)
  .usage(<span class="hljs-string">'[debug] [options] [files]'</span>)
  .option(<span class="hljs-string">'-A, --async-only'</span>, <span class="hljs-string">'force all tests to take a callback (async) or return a promise'</span>)
  .option(<span class="hljs-string">'-c, --colors'</span>, <span class="hljs-string">'force enabling of colors'</span>)
  .option(<span class="hljs-string">'-C, --no-colors'</span>, <span class="hljs-string">'force disabling of colors'</span>)
  .option(<span class="hljs-string">'-G, --growl'</span>, <span class="hljs-string">'enable growl notification support'</span>)
  .option(<span class="hljs-string">'-O, --reporter-options &lt;k=v,k2=v2,...&gt;'</span>, <span class="hljs-string">'reporter-specific options'</span>)
  .option(<span class="hljs-string">'-R, --reporter &lt;name&gt;'</span>, <span class="hljs-string">'specify the reporter to use'</span>, <span class="hljs-string">'spec'</span>)
  .option(<span class="hljs-string">'-S, --sort'</span>, <span class="hljs-string">'sort test files'</span>)
  .option(<span class="hljs-string">'-b, --bail'</span>, <span class="hljs-string">'bail after first test failure'</span>)
  .option(<span class="hljs-string">'-d, --debug'</span>, <span class="hljs-string">"enable node's debugger, synonym for node --debug"</span>)
  .option(<span class="hljs-string">'-g, --grep &lt;pattern&gt;'</span>, <span class="hljs-string">'only run tests matching &lt;pattern&gt;'</span>)
  .option(<span class="hljs-string">'-f, --fgrep &lt;string&gt;'</span>, <span class="hljs-string">'only run tests containing &lt;string&gt;'</span>)
  .option(<span class="hljs-string">'-gc, --expose-gc'</span>, <span class="hljs-string">'expose gc extension'</span>)
  .option(<span class="hljs-string">'-i, --invert'</span>, <span class="hljs-string">'inverts --grep and --fgrep matches'</span>)
  .option(<span class="hljs-string">'-r, --require &lt;name&gt;'</span>, <span class="hljs-string">'require the given module'</span>)
  .option(<span class="hljs-string">'-s, --slow &lt;ms&gt;'</span>, <span class="hljs-string">'"slow" test threshold in milliseconds [75]'</span>)
  .option(<span class="hljs-string">'-t, --timeout &lt;ms&gt;'</span>, <span class="hljs-string">'set test-case timeout in milliseconds [2000]'</span>)
  .option(<span class="hljs-string">'-u, --ui &lt;name&gt;'</span>, <span class="hljs-string">'specify user-interface ('</span> + interfaceNames.join(<span class="hljs-string">'|'</span>) + <span class="hljs-string">')'</span>, <span class="hljs-string">'bdd'</span>)
  .option(<span class="hljs-string">'-w, --watch'</span>, <span class="hljs-string">'watch files for changes'</span>)
  .option(<span class="hljs-string">'--check-leaks'</span>, <span class="hljs-string">'check for global variable leaks'</span>)
  .option(<span class="hljs-string">'--full-trace'</span>, <span class="hljs-string">'display the full stack trace'</span>)
  .option(<span class="hljs-string">'--compilers &lt;ext&gt;:&lt;module&gt;,...'</span>, <span class="hljs-string">'use the given module(s) to compile files'</span>, list, [])
  .option(<span class="hljs-string">'--debug-brk'</span>, <span class="hljs-string">"enable node's debugger breaking on the first line"</span>)
  .option(<span class="hljs-string">'--globals &lt;names&gt;'</span>, <span class="hljs-string">'allow the given comma-delimited global [names]'</span>, list, [])
  .option(<span class="hljs-string">'--es_staging'</span>, <span class="hljs-string">'enable all staged features'</span>)
  .option(<span class="hljs-string">'--harmony&lt;_classes,_generators,...&gt;'</span>, <span class="hljs-string">'all node --harmony* flags are available'</span>)
  .option(<span class="hljs-string">'--preserve-symlinks'</span>, <span class="hljs-string">'Instructs the module loader to preserve symbolic links when resolving and caching modules'</span>)
  .option(<span class="hljs-string">'--icu-data-dir'</span>, <span class="hljs-string">'include ICU data'</span>)
  .option(<span class="hljs-string">'--inline-diffs'</span>, <span class="hljs-string">'display actual/expected differences inline within each string'</span>)
  .option(<span class="hljs-string">'--inspect'</span>, <span class="hljs-string">'activate devtools in chrome'</span>)
  .option(<span class="hljs-string">'--inspect-brk'</span>, <span class="hljs-string">'activate devtools in chrome and break on the first line'</span>)
  .option(<span class="hljs-string">'--interfaces'</span>, <span class="hljs-string">'display available interfaces'</span>)
  .option(<span class="hljs-string">'--no-deprecation'</span>, <span class="hljs-string">'silence deprecation warnings'</span>)
  .option(<span class="hljs-string">'--no-exit'</span>, <span class="hljs-string">'require a clean shutdown of the event loop: mocha will not call process.exit'</span>)
  .option(<span class="hljs-string">'--no-timeouts'</span>, <span class="hljs-string">'disables timeouts, given implicitly with --debug'</span>)
  .option(<span class="hljs-string">'--no-warnings'</span>, <span class="hljs-string">'silence all node process warnings'</span>)
  .option(<span class="hljs-string">'--opts &lt;path&gt;'</span>, <span class="hljs-string">'specify opts path'</span>, <span class="hljs-string">'test/mocha.opts'</span>)
  .option(<span class="hljs-string">'--perf-basic-prof'</span>, <span class="hljs-string">'enable perf linux profiler (basic support)'</span>)
  .option(<span class="hljs-string">'--napi-modules'</span>, <span class="hljs-string">'enable experimental NAPI modules'</span>)
  .option(<span class="hljs-string">'--prof'</span>, <span class="hljs-string">'log statistical profiling information'</span>)
  .option(<span class="hljs-string">'--log-timer-events'</span>, <span class="hljs-string">'Time events including external callbacks'</span>)
  .option(<span class="hljs-string">'--recursive'</span>, <span class="hljs-string">'include sub directories'</span>)
  .option(<span class="hljs-string">'--reporters'</span>, <span class="hljs-string">'display available reporters'</span>)
  .option(<span class="hljs-string">'--retries &lt;times&gt;'</span>, <span class="hljs-string">'set numbers of time to retry a failed test case'</span>)
  .option(<span class="hljs-string">'--throw-deprecation'</span>, <span class="hljs-string">'throw an exception anytime a deprecated function is used'</span>)
  .option(<span class="hljs-string">'--trace'</span>, <span class="hljs-string">'trace function calls'</span>)
  .option(<span class="hljs-string">'--trace-deprecation'</span>, <span class="hljs-string">'show stack traces on deprecations'</span>)
  .option(<span class="hljs-string">'--trace-warnings'</span>, <span class="hljs-string">'show stack traces on node process warnings'</span>)
  .option(<span class="hljs-string">'--use_strict'</span>, <span class="hljs-string">'enforce strict mode'</span>)
  .option(<span class="hljs-string">'--watch-extensions &lt;ext&gt;,...'</span>, <span class="hljs-string">'additional extensions to monitor with --watch'</span>, list, [])
  .option(<span class="hljs-string">'--delay'</span>, <span class="hljs-string">'wait for async suite definition'</span>)
  .option(<span class="hljs-string">'--allow-uncaught'</span>, <span class="hljs-string">'enable uncaught errors to propagate'</span>)
  .option(<span class="hljs-string">'--forbid-only'</span>, <span class="hljs-string">'causes test marked with only to fail the suite'</span>)
  .option(<span class="hljs-string">'--forbid-pending'</span>, <span class="hljs-string">'causes pending tests and test marked with skip to fail the suite'</span>);

program._name = <span class="hljs-string">'mocha'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>init command</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
program
  .command(<span class="hljs-string">'init &lt;path&gt;'</span>)
  .description(<span class="hljs-string">'initialize a client-side mocha setup at &lt;path&gt;'</span>)
  .action(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path</span>) </span>{
    <span class="hljs-keyword">var</span> mkdir = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mkdirp'</span>);
    mkdir.sync(path);
    <span class="hljs-keyword">var</span> css = fs.readFileSync(join(__dirname, <span class="hljs-string">'..'</span>, <span class="hljs-string">'mocha.css'</span>));
    <span class="hljs-keyword">var</span> js = fs.readFileSync(join(__dirname, <span class="hljs-string">'..'</span>, <span class="hljs-string">'mocha.js'</span>));
    <span class="hljs-keyword">var</span> tmpl = fs.readFileSync(join(__dirname, <span class="hljs-string">'..'</span>, <span class="hljs-string">'lib/template.html'</span>));
    fs.writeFileSync(join(path, <span class="hljs-string">'mocha.css'</span>), css);
    fs.writeFileSync(join(path, <span class="hljs-string">'mocha.js'</span>), js);
    fs.writeFileSync(join(path, <span class="hljs-string">'tests.js'</span>), <span class="hljs-string">''</span>);
    fs.writeFileSync(join(path, <span class="hljs-string">'index.html'</span>), tmpl);
    process.exit(<span class="hljs-number">0</span>);
  });

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>--globals</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
program.on(<span class="hljs-string">'globals'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{
  globals = globals.concat(list(val));
});

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>--reporters</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
program.on(<span class="hljs-string">'reporters'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.log();
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'    dot - dot matrix'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'    doc - html documentation'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'    spec - hierarchical spec list'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'    json - single json object'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'    progress - progress bar'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'    list - spec-style listing'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'    tap - test-anything-protocol'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'    landing - unicode landing strip'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'    xunit - xunit reporter'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'    min - minimal reporter (great with --watch)'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'    json-stream - newline delimited json events'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'    markdown - markdown documentation (github flavour)'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'    nyan - nyan cat!'</span>);
  <span class="hljs-built_in">console</span>.log();
  process.exit();
});

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>--interfaces</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
program.on(<span class="hljs-string">'interfaces'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">''</span>);
  interfaceNames.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">interfaceName</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'    '</span> + interfaceName);
  });
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">''</span>);
  process.exit();
});

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>-r, --require</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-built_in">module</span>.paths.push(cwd, join(cwd, <span class="hljs-string">'node_modules'</span>));

program.on(<span class="hljs-string">'require'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">mod</span>) </span>{
  <span class="hljs-keyword">var</span> abs = exists(mod) || exists(mod + <span class="hljs-string">'.js'</span>);
  <span class="hljs-keyword">if</span> (abs) {
    mod = resolve(mod);
  }
  requires.push(mod);
});

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>If not already done, load mocha.opts</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">if</span> (!process.env.LOADED_MOCHA_OPTS) {
  getOptions();
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>parse args</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
program.parse(process.argv);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>infinite stack traces</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-built_in">Error</span>.stackTraceLimit = <span class="hljs-literal">Infinity</span>; <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> config</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>reporter options</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> reporterOptions = {};
<span class="hljs-keyword">if</span> (program.reporterOptions !== <span class="hljs-literal">undefined</span>) {
  program.reporterOptions.split(<span class="hljs-string">','</span>).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">opt</span>) </span>{
    <span class="hljs-keyword">var</span> L = opt.split(<span class="hljs-string">'='</span>);
    <span class="hljs-keyword">if</span> (L.length &gt; <span class="hljs-number">2</span> || L.length === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"invalid reporter option '"</span> + opt + <span class="hljs-string">"'"</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (L.length === <span class="hljs-number">2</span>) {
      reporterOptions[L[<span class="hljs-number">0</span>]] = L[<span class="hljs-number">1</span>];
    } <span class="hljs-keyword">else</span> {
      reporterOptions[L[<span class="hljs-number">0</span>]] = <span class="hljs-literal">true</span>;
    }
  });
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>reporter</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
mocha.reporter(program.reporter, reporterOptions);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>load reporter</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> Reporter = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">try</span> {
  Reporter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/reporters/'</span> + program.reporter);
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-keyword">try</span> {
    Reporter = <span class="hljs-built_in">require</span>(program.reporter);
  } <span class="hljs-keyword">catch</span> (err2) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'reporter "'</span> + program.reporter + <span class="hljs-string">'" does not exist'</span>);
  }
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>--no-colors</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">if</span> (!program.colors) {
  mocha.useColors(<span class="hljs-literal">false</span>);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>--colors</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">if</span> (~process.argv.indexOf(<span class="hljs-string">'--colors'</span>) || ~process.argv.indexOf(<span class="hljs-string">'-c'</span>)) {
  mocha.useColors(<span class="hljs-literal">true</span>);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>--inline-diffs</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">if</span> (program.inlineDiffs) {
  mocha.useInlineDiffs(<span class="hljs-literal">true</span>);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>--slow <ms></p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">if</span> (program.slow) {
  mocha.suite.slow(program.slow);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>--no-timeouts</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">if</span> (!program.timeouts) {
  mocha.enableTimeouts(<span class="hljs-literal">false</span>);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>--timeout</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">if</span> (program.timeout) {
  mocha.suite.timeout(program.timeout);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>--bail</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
mocha.suite.bail(program.bail);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>--grep</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">if</span> (program.grep) {
  mocha.grep(program.grep);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>--fgrep</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">if</span> (program.fgrep) {
  mocha.fgrep(program.fgrep);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>--invert</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">if</span> (program.invert) {
  mocha.invert();
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>--check-leaks</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">if</span> (program.checkLeaks) {
  mocha.checkLeaks();
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>--stack-trace</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">if</span> (program.fullTrace) {
  mocha.fullTrace();
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>--growl</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">if</span> (program.growl) {
  mocha.growl();
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>--async-only</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">if</span> (program.asyncOnly) {
  mocha.asyncOnly();
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<p>--delay</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">if</span> (program.delay) {
  mocha.delay();
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>--allow-uncaught</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">if</span> (program.allowUncaught) {
  mocha.allowUncaught();
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<p>--globals</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
mocha.globals(globals);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<p>--retries</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">if</span> (program.retries) {
  mocha.suite.retries(program.retries);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<p>--forbid-only</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">if</span> (program.forbidOnly) mocha.forbidOnly();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<p>--forbid-pending</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">if</span> (program.forbidPending) mocha.forbidPending();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>custom compiler support</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> extensions = [<span class="hljs-string">'js'</span>];
program.compilers.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">c</span>) </span>{
  <span class="hljs-keyword">var</span> idx = c.indexOf(<span class="hljs-string">':'</span>);
  <span class="hljs-keyword">var</span> ext = c.slice(<span class="hljs-number">0</span>, idx);
  <span class="hljs-keyword">var</span> mod = c.slice(idx + <span class="hljs-number">1</span>);

  <span class="hljs-keyword">if</span> (mod[<span class="hljs-number">0</span>] === <span class="hljs-string">'.'</span>) {
    mod = join(process.cwd(), mod);
  }
  <span class="hljs-built_in">require</span>(mod);
  extensions.push(ext);
  program.watchExtensions.push(ext);
});

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<p>requires</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
requires.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">mod</span>) </span>{
  <span class="hljs-built_in">require</span>(mod);
});

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42"></a>
</div>
<p>interface</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
mocha.ui(program.ui);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43"></a>
</div>
<p>args</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> args = program.args;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44"></a>
</div>
<p>default files to test/*.{js,coffee}</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">if</span> (!args.length) {
  args.push(<span class="hljs-string">'test'</span>);
}

args.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">arg</span>) </span>{
  <span class="hljs-keyword">var</span> newFiles;
  <span class="hljs-keyword">try</span> {
    newFiles = utils.lookupFiles(arg, extensions, program.recursive);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-keyword">if</span> (err.message.indexOf(<span class="hljs-string">'cannot resolve path'</span>) === <span class="hljs-number">0</span>) {
      <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Warning: Could not find any test files matching pattern: '</span> + arg);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">throw</span> err;
  }

  files = files.concat(newFiles);
});

<span class="hljs-keyword">if</span> (!files.length) {
  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'No test files found'</span>);
  process.exit(<span class="hljs-number">1</span>);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45"></a>
</div>
<p>resolve</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
files = files.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path</span>) </span>{
  <span class="hljs-keyword">return</span> resolve(path);
});

<span class="hljs-keyword">if</span> (program.sort) {
  files.sort();
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46"></a>
</div>
<p>--watch</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> runner;
<span class="hljs-keyword">var</span> loadAndRun;
<span class="hljs-keyword">var</span> purge;
<span class="hljs-keyword">var</span> rerun;

<span class="hljs-keyword">if</span> (program.watch) {
  <span class="hljs-built_in">console</span>.log();
  hideCursor();
  process.on(<span class="hljs-string">'SIGINT'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    showCursor();
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'\n'</span>);
    process.exit(<span class="hljs-number">130</span>);
  });

  <span class="hljs-keyword">var</span> watchFiles = utils.files(cwd, [ <span class="hljs-string">'js'</span> ].concat(program.watchExtensions));
  <span class="hljs-keyword">var</span> runAgain = <span class="hljs-literal">false</span>;

  loadAndRun = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadAndRun</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">try</span> {
      mocha.files = files;
      runAgain = <span class="hljs-literal">false</span>;
      runner = mocha.run(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        runner = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">if</span> (runAgain) {
          rerun();
        }
      });
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-built_in">console</span>.log(e.stack);
    }
  };

  purge = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">purge</span> (<span class="hljs-params"></span>) </span>{
    watchFiles.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">file</span>) </span>{
      <span class="hljs-keyword">delete</span> <span class="hljs-built_in">require</span>.cache[file];
    });
  };

  loadAndRun();

  rerun = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rerun</span> (<span class="hljs-params"></span>) </span>{
    purge();
    stop();
    <span class="hljs-keyword">if</span> (!program.grep) {
      mocha.grep(<span class="hljs-literal">null</span>);
    }
    mocha.suite = mocha.suite.clone();
    mocha.suite.ctx = <span class="hljs-keyword">new</span> Mocha.Context();
    mocha.ui(program.ui);
    loadAndRun();
  };

  utils.watch(watchFiles, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    runAgain = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (runner) {
      runner.abort();
    } <span class="hljs-keyword">else</span> {
      rerun();
    }
  });
} <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47"></a>
</div>
<p>load</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
  mocha.files = files;
  runner = mocha.run(program.exit ? exit : exitLater);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">exitLater</span> (<span class="hljs-params">code</span>) </span>{
  process.on(<span class="hljs-string">'exit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    process.exit(<span class="hljs-built_in">Math</span>.min(code, <span class="hljs-number">255</span>));
  });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">exit</span> (<span class="hljs-params">code</span>) </span>{
  <span class="hljs-keyword">var</span> clampedCode = <span class="hljs-built_in">Math</span>.min(code, <span class="hljs-number">255</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48"></a>
</div>
<p>Eagerly set the process's exit code in case stream.write doesn't
execute its callback before the process terminates.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  process.exitCode = clampedCode;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49"></a>
</div>
<p>flush output for Node.js Windows pipe bug
https://github.com/joyent/node/issues/6247 is just one bug example
https://github.com/visionmedia/mocha/issues/333 has a good discussion</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">done</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (!(draining--)) {
      process.exit(clampedCode);
    }
  }

  <span class="hljs-keyword">var</span> draining = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> streams = [process.stdout, process.stderr];

  streams.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">stream</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50"></a>
</div>
<p>submit empty write request and wait for completion</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    draining += <span class="hljs-number">1</span>;
    stream.write(<span class="hljs-string">''</span>, done);
  });

  done();
}

process.on(<span class="hljs-string">'SIGINT'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  runner.abort();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51"></a>
</div>
<p>This is a hack:
Instead of <code>process.exit(130)</code>, set runner.failures to 130 (exit code for SIGINT)
The amount of failures will be emitted as error code later</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  runner.failures = <span class="hljs-number">130</span>;
});

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52"></a>
</div>
<div class="dox">
<div class="summary">
<p>Parse list.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">list</span> (<span class="hljs-params">str</span>) </span>{
  <span class="hljs-keyword">return</span> str.split(<span class="hljs-regexp">/ *, */</span>);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-53" id="section-53"></a>
</div>
<div class="dox">
<div class="summary">
<p>Hide the cursor.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hideCursor</span> (<span class="hljs-params"></span>) </span>{
  process.stdout.write(<span class="hljs-string">'\u001b[?25l'</span>);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-54" id="section-54"></a>
</div>
<div class="dox">
<div class="summary">
<p>Show the cursor.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showCursor</span> (<span class="hljs-params"></span>) </span>{
  process.stdout.write(<span class="hljs-string">'\u001b[?25h'</span>);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55"></a>
</div>
<div class="dox">
<div class="summary">
<p>Stop play()ing.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stop</span> (<span class="hljs-params"></span>) </span>{
  process.stdout.write(<span class="hljs-string">'\u001b[2K'</span>);
  clearInterval(play.timer);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56"></a>
</div>
<div class="dox">
<div class="summary">
<p>Play the given array of strings.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">play</span> (<span class="hljs-params">arr, interval</span>) </span>{
  <span class="hljs-keyword">var</span> len = arr.length;
  interval = interval || <span class="hljs-number">100</span>;
  <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;

  play.timer = setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> str = arr[i++ % len];
    process.stdout.write(<span class="hljs-string">'\u001b[0G'</span> + str);
  }, interval);
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
