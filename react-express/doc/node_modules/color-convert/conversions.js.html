<!DOCTYPE html>
<html>
<head>
  <title>conversions.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/color-convert/conversions.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>conversions.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-comment">/* MIT license */</span>
<span class="hljs-keyword">var</span> cssKeywords = <span class="hljs-built_in">require</span>(<span class="hljs-string">'color-name'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>NOTE: conversions should only return primitive values (i.e. arrays, or
values that give correct <code>typeof</code> results).
do not use box values types (i.e. Number(), String(), etc.)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> reverseKeywords = {};
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> cssKeywords) {
	<span class="hljs-keyword">if</span> (cssKeywords.hasOwnProperty(key)) {
		reverseKeywords[cssKeywords[key]] = key;
	}
}

<span class="hljs-keyword">var</span> convert = <span class="hljs-built_in">module</span>.exports = {
	<span class="hljs-attr">rgb</span>: {<span class="hljs-attr">channels</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">labels</span>: <span class="hljs-string">'rgb'</span>},
	<span class="hljs-attr">hsl</span>: {<span class="hljs-attr">channels</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">labels</span>: <span class="hljs-string">'hsl'</span>},
	<span class="hljs-attr">hsv</span>: {<span class="hljs-attr">channels</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">labels</span>: <span class="hljs-string">'hsv'</span>},
	<span class="hljs-attr">hwb</span>: {<span class="hljs-attr">channels</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">labels</span>: <span class="hljs-string">'hwb'</span>},
	<span class="hljs-attr">cmyk</span>: {<span class="hljs-attr">channels</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">labels</span>: <span class="hljs-string">'cmyk'</span>},
	<span class="hljs-attr">xyz</span>: {<span class="hljs-attr">channels</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">labels</span>: <span class="hljs-string">'xyz'</span>},
	<span class="hljs-attr">lab</span>: {<span class="hljs-attr">channels</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">labels</span>: <span class="hljs-string">'lab'</span>},
	<span class="hljs-attr">lch</span>: {<span class="hljs-attr">channels</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">labels</span>: <span class="hljs-string">'lch'</span>},
	<span class="hljs-attr">hex</span>: {<span class="hljs-attr">channels</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">labels</span>: [<span class="hljs-string">'hex'</span>]},
	<span class="hljs-attr">keyword</span>: {<span class="hljs-attr">channels</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">labels</span>: [<span class="hljs-string">'keyword'</span>]},
	<span class="hljs-attr">ansi16</span>: {<span class="hljs-attr">channels</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">labels</span>: [<span class="hljs-string">'ansi16'</span>]},
	<span class="hljs-attr">ansi256</span>: {<span class="hljs-attr">channels</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">labels</span>: [<span class="hljs-string">'ansi256'</span>]},
	<span class="hljs-attr">hcg</span>: {<span class="hljs-attr">channels</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">labels</span>: [<span class="hljs-string">'h'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'g'</span>]},
	<span class="hljs-attr">apple</span>: {<span class="hljs-attr">channels</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">labels</span>: [<span class="hljs-string">'r16'</span>, <span class="hljs-string">'g16'</span>, <span class="hljs-string">'b16'</span>]},
	<span class="hljs-attr">gray</span>: {<span class="hljs-attr">channels</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">labels</span>: [<span class="hljs-string">'gray'</span>]}
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>hide .channels and .labels properties</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> model <span class="hljs-keyword">in</span> convert) {
	<span class="hljs-keyword">if</span> (convert.hasOwnProperty(model)) {
		<span class="hljs-keyword">if</span> (!(<span class="hljs-string">'channels'</span> <span class="hljs-keyword">in</span> convert[model])) {
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'missing channels property: '</span> + model);
		}

		<span class="hljs-keyword">if</span> (!(<span class="hljs-string">'labels'</span> <span class="hljs-keyword">in</span> convert[model])) {
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'missing channel labels property: '</span> + model);
		}

		<span class="hljs-keyword">if</span> (convert[model].labels.length !== convert[model].channels) {
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'channel and label counts mismatch: '</span> + model);
		}

		<span class="hljs-keyword">var</span> channels = convert[model].channels;
		<span class="hljs-keyword">var</span> labels = convert[model].labels;
		<span class="hljs-keyword">delete</span> convert[model].channels;
		<span class="hljs-keyword">delete</span> convert[model].labels;
		<span class="hljs-built_in">Object</span>.defineProperty(convert[model], <span class="hljs-string">'channels'</span>, {<span class="hljs-attr">value</span>: channels});
		<span class="hljs-built_in">Object</span>.defineProperty(convert[model], <span class="hljs-string">'labels'</span>, {<span class="hljs-attr">value</span>: labels});
	}
}

convert.rgb.hsl = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">rgb</span>) </span>{
	<span class="hljs-keyword">var</span> r = rgb[<span class="hljs-number">0</span>] / <span class="hljs-number">255</span>;
	<span class="hljs-keyword">var</span> g = rgb[<span class="hljs-number">1</span>] / <span class="hljs-number">255</span>;
	<span class="hljs-keyword">var</span> b = rgb[<span class="hljs-number">2</span>] / <span class="hljs-number">255</span>;
	<span class="hljs-keyword">var</span> min = <span class="hljs-built_in">Math</span>.min(r, g, b);
	<span class="hljs-keyword">var</span> max = <span class="hljs-built_in">Math</span>.max(r, g, b);
	<span class="hljs-keyword">var</span> delta = max - min;
	<span class="hljs-keyword">var</span> h;
	<span class="hljs-keyword">var</span> s;
	<span class="hljs-keyword">var</span> l;

	<span class="hljs-keyword">if</span> (max === min) {
		h = <span class="hljs-number">0</span>;
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (r === max) {
		h = (g - b) / delta;
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (g === max) {
		h = <span class="hljs-number">2</span> + (b - r) / delta;
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (b === max) {
		h = <span class="hljs-number">4</span> + (r - g) / delta;
	}

	h = <span class="hljs-built_in">Math</span>.min(h * <span class="hljs-number">60</span>, <span class="hljs-number">360</span>);

	<span class="hljs-keyword">if</span> (h &lt; <span class="hljs-number">0</span>) {
		h += <span class="hljs-number">360</span>;
	}

	l = (min + max) / <span class="hljs-number">2</span>;

	<span class="hljs-keyword">if</span> (max === min) {
		s = <span class="hljs-number">0</span>;
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (l &lt;= <span class="hljs-number">0.5</span>) {
		s = delta / (max + min);
	} <span class="hljs-keyword">else</span> {
		s = delta / (<span class="hljs-number">2</span> - max - min);
	}

	<span class="hljs-keyword">return</span> [h, s * <span class="hljs-number">100</span>, l * <span class="hljs-number">100</span>];
};

convert.rgb.hsv = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">rgb</span>) </span>{
	<span class="hljs-keyword">var</span> r = rgb[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">var</span> g = rgb[<span class="hljs-number">1</span>];
	<span class="hljs-keyword">var</span> b = rgb[<span class="hljs-number">2</span>];
	<span class="hljs-keyword">var</span> min = <span class="hljs-built_in">Math</span>.min(r, g, b);
	<span class="hljs-keyword">var</span> max = <span class="hljs-built_in">Math</span>.max(r, g, b);
	<span class="hljs-keyword">var</span> delta = max - min;
	<span class="hljs-keyword">var</span> h;
	<span class="hljs-keyword">var</span> s;
	<span class="hljs-keyword">var</span> v;

	<span class="hljs-keyword">if</span> (max === <span class="hljs-number">0</span>) {
		s = <span class="hljs-number">0</span>;
	} <span class="hljs-keyword">else</span> {
		s = (delta / max * <span class="hljs-number">1000</span>) / <span class="hljs-number">10</span>;
	}

	<span class="hljs-keyword">if</span> (max === min) {
		h = <span class="hljs-number">0</span>;
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (r === max) {
		h = (g - b) / delta;
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (g === max) {
		h = <span class="hljs-number">2</span> + (b - r) / delta;
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (b === max) {
		h = <span class="hljs-number">4</span> + (r - g) / delta;
	}

	h = <span class="hljs-built_in">Math</span>.min(h * <span class="hljs-number">60</span>, <span class="hljs-number">360</span>);

	<span class="hljs-keyword">if</span> (h &lt; <span class="hljs-number">0</span>) {
		h += <span class="hljs-number">360</span>;
	}

	v = ((max / <span class="hljs-number">255</span>) * <span class="hljs-number">1000</span>) / <span class="hljs-number">10</span>;

	<span class="hljs-keyword">return</span> [h, s, v];
};

convert.rgb.hwb = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">rgb</span>) </span>{
	<span class="hljs-keyword">var</span> r = rgb[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">var</span> g = rgb[<span class="hljs-number">1</span>];
	<span class="hljs-keyword">var</span> b = rgb[<span class="hljs-number">2</span>];
	<span class="hljs-keyword">var</span> h = convert.rgb.hsl(rgb)[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">var</span> w = <span class="hljs-number">1</span> / <span class="hljs-number">255</span> * <span class="hljs-built_in">Math</span>.min(r, <span class="hljs-built_in">Math</span>.min(g, b));

	b = <span class="hljs-number">1</span> - <span class="hljs-number">1</span> / <span class="hljs-number">255</span> * <span class="hljs-built_in">Math</span>.max(r, <span class="hljs-built_in">Math</span>.max(g, b));

	<span class="hljs-keyword">return</span> [h, w * <span class="hljs-number">100</span>, b * <span class="hljs-number">100</span>];
};

convert.rgb.cmyk = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">rgb</span>) </span>{
	<span class="hljs-keyword">var</span> r = rgb[<span class="hljs-number">0</span>] / <span class="hljs-number">255</span>;
	<span class="hljs-keyword">var</span> g = rgb[<span class="hljs-number">1</span>] / <span class="hljs-number">255</span>;
	<span class="hljs-keyword">var</span> b = rgb[<span class="hljs-number">2</span>] / <span class="hljs-number">255</span>;
	<span class="hljs-keyword">var</span> c;
	<span class="hljs-keyword">var</span> m;
	<span class="hljs-keyword">var</span> y;
	<span class="hljs-keyword">var</span> k;

	k = <span class="hljs-built_in">Math</span>.min(<span class="hljs-number">1</span> - r, <span class="hljs-number">1</span> - g, <span class="hljs-number">1</span> - b);
	c = (<span class="hljs-number">1</span> - r - k) / (<span class="hljs-number">1</span> - k) || <span class="hljs-number">0</span>;
	m = (<span class="hljs-number">1</span> - g - k) / (<span class="hljs-number">1</span> - k) || <span class="hljs-number">0</span>;
	y = (<span class="hljs-number">1</span> - b - k) / (<span class="hljs-number">1</span> - k) || <span class="hljs-number">0</span>;

	<span class="hljs-keyword">return</span> [c * <span class="hljs-number">100</span>, m * <span class="hljs-number">100</span>, y * <span class="hljs-number">100</span>, k * <span class="hljs-number">100</span>];
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>See https://en.m.wikipedia.org/wiki/Euclidean_distance#Squared_Euclidean_distance</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">comparativeDistance</span>(<span class="hljs-params">x, y</span>) </span>{
	<span class="hljs-keyword">return</span> (
		<span class="hljs-built_in">Math</span>.pow(x[<span class="hljs-number">0</span>] - y[<span class="hljs-number">0</span>], <span class="hljs-number">2</span>) +
		<span class="hljs-built_in">Math</span>.pow(x[<span class="hljs-number">1</span>] - y[<span class="hljs-number">1</span>], <span class="hljs-number">2</span>) +
		<span class="hljs-built_in">Math</span>.pow(x[<span class="hljs-number">2</span>] - y[<span class="hljs-number">2</span>], <span class="hljs-number">2</span>)
	);
}

convert.rgb.keyword = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">rgb</span>) </span>{
	<span class="hljs-keyword">var</span> reversed = reverseKeywords[rgb];
	<span class="hljs-keyword">if</span> (reversed) {
		<span class="hljs-keyword">return</span> reversed;
	}

	<span class="hljs-keyword">var</span> currentClosestDistance = <span class="hljs-literal">Infinity</span>;
	<span class="hljs-keyword">var</span> currentClosestKeyword;

	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> keyword <span class="hljs-keyword">in</span> cssKeywords) {
		<span class="hljs-keyword">if</span> (cssKeywords.hasOwnProperty(keyword)) {
			<span class="hljs-keyword">var</span> value = cssKeywords[keyword];

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Compute comparative distance</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">			<span class="hljs-keyword">var</span> distance = comparativeDistance(rgb, value);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Check if its less, if so set as closest</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">			<span class="hljs-keyword">if</span> (distance &lt; currentClosestDistance) {
				currentClosestDistance = distance;
				currentClosestKeyword = keyword;
			}
		}
	}

	<span class="hljs-keyword">return</span> currentClosestKeyword;
};

convert.keyword.rgb = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">keyword</span>) </span>{
	<span class="hljs-keyword">return</span> cssKeywords[keyword];
};

convert.rgb.xyz = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">rgb</span>) </span>{
	<span class="hljs-keyword">var</span> r = rgb[<span class="hljs-number">0</span>] / <span class="hljs-number">255</span>;
	<span class="hljs-keyword">var</span> g = rgb[<span class="hljs-number">1</span>] / <span class="hljs-number">255</span>;
	<span class="hljs-keyword">var</span> b = rgb[<span class="hljs-number">2</span>] / <span class="hljs-number">255</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>assume sRGB</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	r = r &gt; <span class="hljs-number">0.04045</span> ? <span class="hljs-built_in">Math</span>.pow(((r + <span class="hljs-number">0.055</span>) / <span class="hljs-number">1.055</span>), <span class="hljs-number">2.4</span>) : (r / <span class="hljs-number">12.92</span>);
	g = g &gt; <span class="hljs-number">0.04045</span> ? <span class="hljs-built_in">Math</span>.pow(((g + <span class="hljs-number">0.055</span>) / <span class="hljs-number">1.055</span>), <span class="hljs-number">2.4</span>) : (g / <span class="hljs-number">12.92</span>);
	b = b &gt; <span class="hljs-number">0.04045</span> ? <span class="hljs-built_in">Math</span>.pow(((b + <span class="hljs-number">0.055</span>) / <span class="hljs-number">1.055</span>), <span class="hljs-number">2.4</span>) : (b / <span class="hljs-number">12.92</span>);

	<span class="hljs-keyword">var</span> x = (r * <span class="hljs-number">0.4124</span>) + (g * <span class="hljs-number">0.3576</span>) + (b * <span class="hljs-number">0.1805</span>);
	<span class="hljs-keyword">var</span> y = (r * <span class="hljs-number">0.2126</span>) + (g * <span class="hljs-number">0.7152</span>) + (b * <span class="hljs-number">0.0722</span>);
	<span class="hljs-keyword">var</span> z = (r * <span class="hljs-number">0.0193</span>) + (g * <span class="hljs-number">0.1192</span>) + (b * <span class="hljs-number">0.9505</span>);

	<span class="hljs-keyword">return</span> [x * <span class="hljs-number">100</span>, y * <span class="hljs-number">100</span>, z * <span class="hljs-number">100</span>];
};

convert.rgb.lab = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">rgb</span>) </span>{
	<span class="hljs-keyword">var</span> xyz = convert.rgb.xyz(rgb);
	<span class="hljs-keyword">var</span> x = xyz[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">var</span> y = xyz[<span class="hljs-number">1</span>];
	<span class="hljs-keyword">var</span> z = xyz[<span class="hljs-number">2</span>];
	<span class="hljs-keyword">var</span> l;
	<span class="hljs-keyword">var</span> a;
	<span class="hljs-keyword">var</span> b;

	x /= <span class="hljs-number">95.047</span>;
	y /= <span class="hljs-number">100</span>;
	z /= <span class="hljs-number">108.883</span>;

	x = x &gt; <span class="hljs-number">0.008856</span> ? <span class="hljs-built_in">Math</span>.pow(x, <span class="hljs-number">1</span> / <span class="hljs-number">3</span>) : (<span class="hljs-number">7.787</span> * x) + (<span class="hljs-number">16</span> / <span class="hljs-number">116</span>);
	y = y &gt; <span class="hljs-number">0.008856</span> ? <span class="hljs-built_in">Math</span>.pow(y, <span class="hljs-number">1</span> / <span class="hljs-number">3</span>) : (<span class="hljs-number">7.787</span> * y) + (<span class="hljs-number">16</span> / <span class="hljs-number">116</span>);
	z = z &gt; <span class="hljs-number">0.008856</span> ? <span class="hljs-built_in">Math</span>.pow(z, <span class="hljs-number">1</span> / <span class="hljs-number">3</span>) : (<span class="hljs-number">7.787</span> * z) + (<span class="hljs-number">16</span> / <span class="hljs-number">116</span>);

	l = (<span class="hljs-number">116</span> * y) - <span class="hljs-number">16</span>;
	a = <span class="hljs-number">500</span> * (x - y);
	b = <span class="hljs-number">200</span> * (y - z);

	<span class="hljs-keyword">return</span> [l, a, b];
};

convert.hsl.rgb = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">hsl</span>) </span>{
	<span class="hljs-keyword">var</span> h = hsl[<span class="hljs-number">0</span>] / <span class="hljs-number">360</span>;
	<span class="hljs-keyword">var</span> s = hsl[<span class="hljs-number">1</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> l = hsl[<span class="hljs-number">2</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> t1;
	<span class="hljs-keyword">var</span> t2;
	<span class="hljs-keyword">var</span> t3;
	<span class="hljs-keyword">var</span> rgb;
	<span class="hljs-keyword">var</span> val;

	<span class="hljs-keyword">if</span> (s === <span class="hljs-number">0</span>) {
		val = l * <span class="hljs-number">255</span>;
		<span class="hljs-keyword">return</span> [val, val, val];
	}

	<span class="hljs-keyword">if</span> (l &lt; <span class="hljs-number">0.5</span>) {
		t2 = l * (<span class="hljs-number">1</span> + s);
	} <span class="hljs-keyword">else</span> {
		t2 = l + s - l * s;
	}

	t1 = <span class="hljs-number">2</span> * l - t2;

	rgb = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>];
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
		t3 = h + <span class="hljs-number">1</span> / <span class="hljs-number">3</span> * -(i - <span class="hljs-number">1</span>);
		<span class="hljs-keyword">if</span> (t3 &lt; <span class="hljs-number">0</span>) {
			t3++;
		}
		<span class="hljs-keyword">if</span> (t3 &gt; <span class="hljs-number">1</span>) {
			t3--;
		}

		<span class="hljs-keyword">if</span> (<span class="hljs-number">6</span> * t3 &lt; <span class="hljs-number">1</span>) {
			val = t1 + (t2 - t1) * <span class="hljs-number">6</span> * t3;
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-number">2</span> * t3 &lt; <span class="hljs-number">1</span>) {
			val = t2;
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-number">3</span> * t3 &lt; <span class="hljs-number">2</span>) {
			val = t1 + (t2 - t1) * (<span class="hljs-number">2</span> / <span class="hljs-number">3</span> - t3) * <span class="hljs-number">6</span>;
		} <span class="hljs-keyword">else</span> {
			val = t1;
		}

		rgb[i] = val * <span class="hljs-number">255</span>;
	}

	<span class="hljs-keyword">return</span> rgb;
};

convert.hsl.hsv = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">hsl</span>) </span>{
	<span class="hljs-keyword">var</span> h = hsl[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">var</span> s = hsl[<span class="hljs-number">1</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> l = hsl[<span class="hljs-number">2</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> smin = s;
	<span class="hljs-keyword">var</span> lmin = <span class="hljs-built_in">Math</span>.max(l, <span class="hljs-number">0.01</span>);
	<span class="hljs-keyword">var</span> sv;
	<span class="hljs-keyword">var</span> v;

	l *= <span class="hljs-number">2</span>;
	s *= (l &lt;= <span class="hljs-number">1</span>) ? l : <span class="hljs-number">2</span> - l;
	smin *= lmin &lt;= <span class="hljs-number">1</span> ? lmin : <span class="hljs-number">2</span> - lmin;
	v = (l + s) / <span class="hljs-number">2</span>;
	sv = l === <span class="hljs-number">0</span> ? (<span class="hljs-number">2</span> * smin) / (lmin + smin) : (<span class="hljs-number">2</span> * s) / (l + s);

	<span class="hljs-keyword">return</span> [h, sv * <span class="hljs-number">100</span>, v * <span class="hljs-number">100</span>];
};

convert.hsv.rgb = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">hsv</span>) </span>{
	<span class="hljs-keyword">var</span> h = hsv[<span class="hljs-number">0</span>] / <span class="hljs-number">60</span>;
	<span class="hljs-keyword">var</span> s = hsv[<span class="hljs-number">1</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> v = hsv[<span class="hljs-number">2</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> hi = <span class="hljs-built_in">Math</span>.floor(h) % <span class="hljs-number">6</span>;

	<span class="hljs-keyword">var</span> f = h - <span class="hljs-built_in">Math</span>.floor(h);
	<span class="hljs-keyword">var</span> p = <span class="hljs-number">255</span> * v * (<span class="hljs-number">1</span> - s);
	<span class="hljs-keyword">var</span> q = <span class="hljs-number">255</span> * v * (<span class="hljs-number">1</span> - (s * f));
	<span class="hljs-keyword">var</span> t = <span class="hljs-number">255</span> * v * (<span class="hljs-number">1</span> - (s * (<span class="hljs-number">1</span> - f)));
	v *= <span class="hljs-number">255</span>;

	<span class="hljs-keyword">switch</span> (hi) {
		<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
			<span class="hljs-keyword">return</span> [v, t, p];
		<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
			<span class="hljs-keyword">return</span> [q, v, p];
		<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
			<span class="hljs-keyword">return</span> [p, v, t];
		<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
			<span class="hljs-keyword">return</span> [p, q, v];
		<span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:
			<span class="hljs-keyword">return</span> [t, p, v];
		<span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:
			<span class="hljs-keyword">return</span> [v, p, q];
	}
};

convert.hsv.hsl = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">hsv</span>) </span>{
	<span class="hljs-keyword">var</span> h = hsv[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">var</span> s = hsv[<span class="hljs-number">1</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> v = hsv[<span class="hljs-number">2</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> vmin = <span class="hljs-built_in">Math</span>.max(v, <span class="hljs-number">0.01</span>);
	<span class="hljs-keyword">var</span> lmin;
	<span class="hljs-keyword">var</span> sl;
	<span class="hljs-keyword">var</span> l;

	l = (<span class="hljs-number">2</span> - s) * v;
	lmin = (<span class="hljs-number">2</span> - s) * vmin;
	sl = s * vmin;
	sl /= (lmin &lt;= <span class="hljs-number">1</span>) ? lmin : <span class="hljs-number">2</span> - lmin;
	sl = sl || <span class="hljs-number">0</span>;
	l /= <span class="hljs-number">2</span>;

	<span class="hljs-keyword">return</span> [h, sl * <span class="hljs-number">100</span>, l * <span class="hljs-number">100</span>];
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>http://dev.w3.org/csswg/css-color/#hwb-to-rgb</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">convert.hwb.rgb = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">hwb</span>) </span>{
	<span class="hljs-keyword">var</span> h = hwb[<span class="hljs-number">0</span>] / <span class="hljs-number">360</span>;
	<span class="hljs-keyword">var</span> wh = hwb[<span class="hljs-number">1</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> bl = hwb[<span class="hljs-number">2</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> ratio = wh + bl;
	<span class="hljs-keyword">var</span> i;
	<span class="hljs-keyword">var</span> v;
	<span class="hljs-keyword">var</span> f;
	<span class="hljs-keyword">var</span> n;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>wh + bl cant be &gt; 1</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">if</span> (ratio &gt; <span class="hljs-number">1</span>) {
		wh /= ratio;
		bl /= ratio;
	}

	i = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-number">6</span> * h);
	v = <span class="hljs-number">1</span> - bl;
	f = <span class="hljs-number">6</span> * h - i;

	<span class="hljs-keyword">if</span> ((i &amp; <span class="hljs-number">0x01</span>) !== <span class="hljs-number">0</span>) {
		f = <span class="hljs-number">1</span> - f;
	}

	n = wh + f * (v - wh); <span class="hljs-comment">// linear interpolation</span>

	<span class="hljs-keyword">var</span> r;
	<span class="hljs-keyword">var</span> g;
	<span class="hljs-keyword">var</span> b;
	<span class="hljs-keyword">switch</span> (i) {
		<span class="hljs-attr">default</span>:
		<span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:
		<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>: r = v; g = n; b = wh; <span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: r = n; g = v; b = wh; <span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: r = wh; g = v; b = n; <span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: r = wh; g = n; b = v; <span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-number">4</span>: r = n; g = wh; b = v; <span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-number">5</span>: r = v; g = wh; b = n; <span class="hljs-keyword">break</span>;
	}

	<span class="hljs-keyword">return</span> [r * <span class="hljs-number">255</span>, g * <span class="hljs-number">255</span>, b * <span class="hljs-number">255</span>];
};

convert.cmyk.rgb = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cmyk</span>) </span>{
	<span class="hljs-keyword">var</span> c = cmyk[<span class="hljs-number">0</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> m = cmyk[<span class="hljs-number">1</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> y = cmyk[<span class="hljs-number">2</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> k = cmyk[<span class="hljs-number">3</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> r;
	<span class="hljs-keyword">var</span> g;
	<span class="hljs-keyword">var</span> b;

	r = <span class="hljs-number">1</span> - <span class="hljs-built_in">Math</span>.min(<span class="hljs-number">1</span>, c * (<span class="hljs-number">1</span> - k) + k);
	g = <span class="hljs-number">1</span> - <span class="hljs-built_in">Math</span>.min(<span class="hljs-number">1</span>, m * (<span class="hljs-number">1</span> - k) + k);
	b = <span class="hljs-number">1</span> - <span class="hljs-built_in">Math</span>.min(<span class="hljs-number">1</span>, y * (<span class="hljs-number">1</span> - k) + k);

	<span class="hljs-keyword">return</span> [r * <span class="hljs-number">255</span>, g * <span class="hljs-number">255</span>, b * <span class="hljs-number">255</span>];
};

convert.xyz.rgb = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">xyz</span>) </span>{
	<span class="hljs-keyword">var</span> x = xyz[<span class="hljs-number">0</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> y = xyz[<span class="hljs-number">1</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> z = xyz[<span class="hljs-number">2</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> r;
	<span class="hljs-keyword">var</span> g;
	<span class="hljs-keyword">var</span> b;

	r = (x * <span class="hljs-number">3.2406</span>) + (y * <span class="hljs-number">-1.5372</span>) + (z * <span class="hljs-number">-0.4986</span>);
	g = (x * <span class="hljs-number">-0.9689</span>) + (y * <span class="hljs-number">1.8758</span>) + (z * <span class="hljs-number">0.0415</span>);
	b = (x * <span class="hljs-number">0.0557</span>) + (y * <span class="hljs-number">-0.2040</span>) + (z * <span class="hljs-number">1.0570</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>assume sRGB</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	r = r &gt; <span class="hljs-number">0.0031308</span>
		? ((<span class="hljs-number">1.055</span> * <span class="hljs-built_in">Math</span>.pow(r, <span class="hljs-number">1.0</span> / <span class="hljs-number">2.4</span>)) - <span class="hljs-number">0.055</span>)
		: r * <span class="hljs-number">12.92</span>;

	g = g &gt; <span class="hljs-number">0.0031308</span>
		? ((<span class="hljs-number">1.055</span> * <span class="hljs-built_in">Math</span>.pow(g, <span class="hljs-number">1.0</span> / <span class="hljs-number">2.4</span>)) - <span class="hljs-number">0.055</span>)
		: g * <span class="hljs-number">12.92</span>;

	b = b &gt; <span class="hljs-number">0.0031308</span>
		? ((<span class="hljs-number">1.055</span> * <span class="hljs-built_in">Math</span>.pow(b, <span class="hljs-number">1.0</span> / <span class="hljs-number">2.4</span>)) - <span class="hljs-number">0.055</span>)
		: b * <span class="hljs-number">12.92</span>;

	r = <span class="hljs-built_in">Math</span>.min(<span class="hljs-built_in">Math</span>.max(<span class="hljs-number">0</span>, r), <span class="hljs-number">1</span>);
	g = <span class="hljs-built_in">Math</span>.min(<span class="hljs-built_in">Math</span>.max(<span class="hljs-number">0</span>, g), <span class="hljs-number">1</span>);
	b = <span class="hljs-built_in">Math</span>.min(<span class="hljs-built_in">Math</span>.max(<span class="hljs-number">0</span>, b), <span class="hljs-number">1</span>);

	<span class="hljs-keyword">return</span> [r * <span class="hljs-number">255</span>, g * <span class="hljs-number">255</span>, b * <span class="hljs-number">255</span>];
};

convert.xyz.lab = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">xyz</span>) </span>{
	<span class="hljs-keyword">var</span> x = xyz[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">var</span> y = xyz[<span class="hljs-number">1</span>];
	<span class="hljs-keyword">var</span> z = xyz[<span class="hljs-number">2</span>];
	<span class="hljs-keyword">var</span> l;
	<span class="hljs-keyword">var</span> a;
	<span class="hljs-keyword">var</span> b;

	x /= <span class="hljs-number">95.047</span>;
	y /= <span class="hljs-number">100</span>;
	z /= <span class="hljs-number">108.883</span>;

	x = x &gt; <span class="hljs-number">0.008856</span> ? <span class="hljs-built_in">Math</span>.pow(x, <span class="hljs-number">1</span> / <span class="hljs-number">3</span>) : (<span class="hljs-number">7.787</span> * x) + (<span class="hljs-number">16</span> / <span class="hljs-number">116</span>);
	y = y &gt; <span class="hljs-number">0.008856</span> ? <span class="hljs-built_in">Math</span>.pow(y, <span class="hljs-number">1</span> / <span class="hljs-number">3</span>) : (<span class="hljs-number">7.787</span> * y) + (<span class="hljs-number">16</span> / <span class="hljs-number">116</span>);
	z = z &gt; <span class="hljs-number">0.008856</span> ? <span class="hljs-built_in">Math</span>.pow(z, <span class="hljs-number">1</span> / <span class="hljs-number">3</span>) : (<span class="hljs-number">7.787</span> * z) + (<span class="hljs-number">16</span> / <span class="hljs-number">116</span>);

	l = (<span class="hljs-number">116</span> * y) - <span class="hljs-number">16</span>;
	a = <span class="hljs-number">500</span> * (x - y);
	b = <span class="hljs-number">200</span> * (y - z);

	<span class="hljs-keyword">return</span> [l, a, b];
};

convert.lab.xyz = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">lab</span>) </span>{
	<span class="hljs-keyword">var</span> l = lab[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">var</span> a = lab[<span class="hljs-number">1</span>];
	<span class="hljs-keyword">var</span> b = lab[<span class="hljs-number">2</span>];
	<span class="hljs-keyword">var</span> x;
	<span class="hljs-keyword">var</span> y;
	<span class="hljs-keyword">var</span> z;

	y = (l + <span class="hljs-number">16</span>) / <span class="hljs-number">116</span>;
	x = a / <span class="hljs-number">500</span> + y;
	z = y - b / <span class="hljs-number">200</span>;

	<span class="hljs-keyword">var</span> y2 = <span class="hljs-built_in">Math</span>.pow(y, <span class="hljs-number">3</span>);
	<span class="hljs-keyword">var</span> x2 = <span class="hljs-built_in">Math</span>.pow(x, <span class="hljs-number">3</span>);
	<span class="hljs-keyword">var</span> z2 = <span class="hljs-built_in">Math</span>.pow(z, <span class="hljs-number">3</span>);
	y = y2 &gt; <span class="hljs-number">0.008856</span> ? y2 : (y - <span class="hljs-number">16</span> / <span class="hljs-number">116</span>) / <span class="hljs-number">7.787</span>;
	x = x2 &gt; <span class="hljs-number">0.008856</span> ? x2 : (x - <span class="hljs-number">16</span> / <span class="hljs-number">116</span>) / <span class="hljs-number">7.787</span>;
	z = z2 &gt; <span class="hljs-number">0.008856</span> ? z2 : (z - <span class="hljs-number">16</span> / <span class="hljs-number">116</span>) / <span class="hljs-number">7.787</span>;

	x *= <span class="hljs-number">95.047</span>;
	y *= <span class="hljs-number">100</span>;
	z *= <span class="hljs-number">108.883</span>;

	<span class="hljs-keyword">return</span> [x, y, z];
};

convert.lab.lch = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">lab</span>) </span>{
	<span class="hljs-keyword">var</span> l = lab[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">var</span> a = lab[<span class="hljs-number">1</span>];
	<span class="hljs-keyword">var</span> b = lab[<span class="hljs-number">2</span>];
	<span class="hljs-keyword">var</span> hr;
	<span class="hljs-keyword">var</span> h;
	<span class="hljs-keyword">var</span> c;

	hr = <span class="hljs-built_in">Math</span>.atan2(b, a);
	h = hr * <span class="hljs-number">360</span> / <span class="hljs-number">2</span> / <span class="hljs-built_in">Math</span>.PI;

	<span class="hljs-keyword">if</span> (h &lt; <span class="hljs-number">0</span>) {
		h += <span class="hljs-number">360</span>;
	}

	c = <span class="hljs-built_in">Math</span>.sqrt(a * a + b * b);

	<span class="hljs-keyword">return</span> [l, c, h];
};

convert.lch.lab = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">lch</span>) </span>{
	<span class="hljs-keyword">var</span> l = lch[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">var</span> c = lch[<span class="hljs-number">1</span>];
	<span class="hljs-keyword">var</span> h = lch[<span class="hljs-number">2</span>];
	<span class="hljs-keyword">var</span> a;
	<span class="hljs-keyword">var</span> b;
	<span class="hljs-keyword">var</span> hr;

	hr = h / <span class="hljs-number">360</span> * <span class="hljs-number">2</span> * <span class="hljs-built_in">Math</span>.PI;
	a = c * <span class="hljs-built_in">Math</span>.cos(hr);
	b = c * <span class="hljs-built_in">Math</span>.sin(hr);

	<span class="hljs-keyword">return</span> [l, a, b];
};

convert.rgb.ansi16 = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">var</span> r = args[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">var</span> g = args[<span class="hljs-number">1</span>];
	<span class="hljs-keyword">var</span> b = args[<span class="hljs-number">2</span>];
	<span class="hljs-keyword">var</span> value = <span class="hljs-number">1</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">arguments</span> ? <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>] : convert.rgb.hsv(args)[<span class="hljs-number">2</span>]; <span class="hljs-comment">// hsv -&gt; ansi16 optimization</span>

	value = <span class="hljs-built_in">Math</span>.round(value / <span class="hljs-number">50</span>);

	<span class="hljs-keyword">if</span> (value === <span class="hljs-number">0</span>) {
		<span class="hljs-keyword">return</span> <span class="hljs-number">30</span>;
	}

	<span class="hljs-keyword">var</span> ansi = <span class="hljs-number">30</span>
		+ ((<span class="hljs-built_in">Math</span>.round(b / <span class="hljs-number">255</span>) &lt;&lt; <span class="hljs-number">2</span>)
		| (<span class="hljs-built_in">Math</span>.round(g / <span class="hljs-number">255</span>) &lt;&lt; <span class="hljs-number">1</span>)
		| <span class="hljs-built_in">Math</span>.round(r / <span class="hljs-number">255</span>));

	<span class="hljs-keyword">if</span> (value === <span class="hljs-number">2</span>) {
		ansi += <span class="hljs-number">60</span>;
	}

	<span class="hljs-keyword">return</span> ansi;
};

convert.hsv.ansi16 = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>optimization here; we already know the value and don't need to get
it converted for us.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">return</span> convert.rgb.ansi16(convert.hsv.rgb(args), args[<span class="hljs-number">2</span>]);
};

convert.rgb.ansi256 = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">var</span> r = args[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">var</span> g = args[<span class="hljs-number">1</span>];
	<span class="hljs-keyword">var</span> b = args[<span class="hljs-number">2</span>];

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>we use the extended greyscale palette here, with the exception of
black and white. normal palette only has 4 greyscale shades.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">if</span> (r === g &amp;&amp; g === b) {
		<span class="hljs-keyword">if</span> (r &lt; <span class="hljs-number">8</span>) {
			<span class="hljs-keyword">return</span> <span class="hljs-number">16</span>;
		}

		<span class="hljs-keyword">if</span> (r &gt; <span class="hljs-number">248</span>) {
			<span class="hljs-keyword">return</span> <span class="hljs-number">231</span>;
		}

		<span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.round(((r - <span class="hljs-number">8</span>) / <span class="hljs-number">247</span>) * <span class="hljs-number">24</span>) + <span class="hljs-number">232</span>;
	}

	<span class="hljs-keyword">var</span> ansi = <span class="hljs-number">16</span>
		+ (<span class="hljs-number">36</span> * <span class="hljs-built_in">Math</span>.round(r / <span class="hljs-number">255</span> * <span class="hljs-number">5</span>))
		+ (<span class="hljs-number">6</span> * <span class="hljs-built_in">Math</span>.round(g / <span class="hljs-number">255</span> * <span class="hljs-number">5</span>))
		+ <span class="hljs-built_in">Math</span>.round(b / <span class="hljs-number">255</span> * <span class="hljs-number">5</span>);

	<span class="hljs-keyword">return</span> ansi;
};

convert.ansi16.rgb = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">var</span> color = args % <span class="hljs-number">10</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>handle greyscale</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">if</span> (color === <span class="hljs-number">0</span> || color === <span class="hljs-number">7</span>) {
		<span class="hljs-keyword">if</span> (args &gt; <span class="hljs-number">50</span>) {
			color += <span class="hljs-number">3.5</span>;
		}

		color = color / <span class="hljs-number">10.5</span> * <span class="hljs-number">255</span>;

		<span class="hljs-keyword">return</span> [color, color, color];
	}

	<span class="hljs-keyword">var</span> mult = (~~(args &gt; <span class="hljs-number">50</span>) + <span class="hljs-number">1</span>) * <span class="hljs-number">0.5</span>;
	<span class="hljs-keyword">var</span> r = ((color &amp; <span class="hljs-number">1</span>) * mult) * <span class="hljs-number">255</span>;
	<span class="hljs-keyword">var</span> g = (((color &gt;&gt; <span class="hljs-number">1</span>) &amp; <span class="hljs-number">1</span>) * mult) * <span class="hljs-number">255</span>;
	<span class="hljs-keyword">var</span> b = (((color &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">1</span>) * mult) * <span class="hljs-number">255</span>;

	<span class="hljs-keyword">return</span> [r, g, b];
};

convert.ansi256.rgb = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>handle greyscale</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">if</span> (args &gt;= <span class="hljs-number">232</span>) {
		<span class="hljs-keyword">var</span> c = (args - <span class="hljs-number">232</span>) * <span class="hljs-number">10</span> + <span class="hljs-number">8</span>;
		<span class="hljs-keyword">return</span> [c, c, c];
	}

	args -= <span class="hljs-number">16</span>;

	<span class="hljs-keyword">var</span> rem;
	<span class="hljs-keyword">var</span> r = <span class="hljs-built_in">Math</span>.floor(args / <span class="hljs-number">36</span>) / <span class="hljs-number">5</span> * <span class="hljs-number">255</span>;
	<span class="hljs-keyword">var</span> g = <span class="hljs-built_in">Math</span>.floor((rem = args % <span class="hljs-number">36</span>) / <span class="hljs-number">6</span>) / <span class="hljs-number">5</span> * <span class="hljs-number">255</span>;
	<span class="hljs-keyword">var</span> b = (rem % <span class="hljs-number">6</span>) / <span class="hljs-number">5</span> * <span class="hljs-number">255</span>;

	<span class="hljs-keyword">return</span> [r, g, b];
};

convert.rgb.hex = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">var</span> integer = ((<span class="hljs-built_in">Math</span>.round(args[<span class="hljs-number">0</span>]) &amp; <span class="hljs-number">0xFF</span>) &lt;&lt; <span class="hljs-number">16</span>)
		+ ((<span class="hljs-built_in">Math</span>.round(args[<span class="hljs-number">1</span>]) &amp; <span class="hljs-number">0xFF</span>) &lt;&lt; <span class="hljs-number">8</span>)
		+ (<span class="hljs-built_in">Math</span>.round(args[<span class="hljs-number">2</span>]) &amp; <span class="hljs-number">0xFF</span>);

	<span class="hljs-keyword">var</span> string = integer.toString(<span class="hljs-number">16</span>).toUpperCase();
	<span class="hljs-keyword">return</span> <span class="hljs-string">'000000'</span>.substring(string.length) + string;
};

convert.hex.rgb = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">var</span> match = args.toString(<span class="hljs-number">16</span>).match(<span class="hljs-regexp">/[a-f0-9]{6}|[a-f0-9]{3}/i</span>);
	<span class="hljs-keyword">if</span> (!match) {
		<span class="hljs-keyword">return</span> [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>];
	}

	<span class="hljs-keyword">var</span> colorString = match[<span class="hljs-number">0</span>];

	<span class="hljs-keyword">if</span> (match[<span class="hljs-number">0</span>].length === <span class="hljs-number">3</span>) {
		colorString = colorString.split(<span class="hljs-string">''</span>).map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">char</span>) </span>{
			<span class="hljs-keyword">return</span> char + char;
		}).join(<span class="hljs-string">''</span>);
	}

	<span class="hljs-keyword">var</span> integer = <span class="hljs-built_in">parseInt</span>(colorString, <span class="hljs-number">16</span>);
	<span class="hljs-keyword">var</span> r = (integer &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>;
	<span class="hljs-keyword">var</span> g = (integer &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>;
	<span class="hljs-keyword">var</span> b = integer &amp; <span class="hljs-number">0xFF</span>;

	<span class="hljs-keyword">return</span> [r, g, b];
};

convert.rgb.hcg = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">rgb</span>) </span>{
	<span class="hljs-keyword">var</span> r = rgb[<span class="hljs-number">0</span>] / <span class="hljs-number">255</span>;
	<span class="hljs-keyword">var</span> g = rgb[<span class="hljs-number">1</span>] / <span class="hljs-number">255</span>;
	<span class="hljs-keyword">var</span> b = rgb[<span class="hljs-number">2</span>] / <span class="hljs-number">255</span>;
	<span class="hljs-keyword">var</span> max = <span class="hljs-built_in">Math</span>.max(<span class="hljs-built_in">Math</span>.max(r, g), b);
	<span class="hljs-keyword">var</span> min = <span class="hljs-built_in">Math</span>.min(<span class="hljs-built_in">Math</span>.min(r, g), b);
	<span class="hljs-keyword">var</span> chroma = (max - min);
	<span class="hljs-keyword">var</span> grayscale;
	<span class="hljs-keyword">var</span> hue;

	<span class="hljs-keyword">if</span> (chroma &lt; <span class="hljs-number">1</span>) {
		grayscale = min / (<span class="hljs-number">1</span> - chroma);
	} <span class="hljs-keyword">else</span> {
		grayscale = <span class="hljs-number">0</span>;
	}

	<span class="hljs-keyword">if</span> (chroma &lt;= <span class="hljs-number">0</span>) {
		hue = <span class="hljs-number">0</span>;
	} <span class="hljs-keyword">else</span>
	<span class="hljs-keyword">if</span> (max === r) {
		hue = ((g - b) / chroma) % <span class="hljs-number">6</span>;
	} <span class="hljs-keyword">else</span>
	<span class="hljs-keyword">if</span> (max === g) {
		hue = <span class="hljs-number">2</span> + (b - r) / chroma;
	} <span class="hljs-keyword">else</span> {
		hue = <span class="hljs-number">4</span> + (r - g) / chroma + <span class="hljs-number">4</span>;
	}

	hue /= <span class="hljs-number">6</span>;
	hue %= <span class="hljs-number">1</span>;

	<span class="hljs-keyword">return</span> [hue * <span class="hljs-number">360</span>, chroma * <span class="hljs-number">100</span>, grayscale * <span class="hljs-number">100</span>];
};

convert.hsl.hcg = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">hsl</span>) </span>{
	<span class="hljs-keyword">var</span> s = hsl[<span class="hljs-number">1</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> l = hsl[<span class="hljs-number">2</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> c = <span class="hljs-number">1</span>;
	<span class="hljs-keyword">var</span> f = <span class="hljs-number">0</span>;

	<span class="hljs-keyword">if</span> (l &lt; <span class="hljs-number">0.5</span>) {
		c = <span class="hljs-number">2.0</span> * s * l;
	} <span class="hljs-keyword">else</span> {
		c = <span class="hljs-number">2.0</span> * s * (<span class="hljs-number">1.0</span> - l);
	}

	<span class="hljs-keyword">if</span> (c &lt; <span class="hljs-number">1.0</span>) {
		f = (l - <span class="hljs-number">0.5</span> * c) / (<span class="hljs-number">1.0</span> - c);
	}

	<span class="hljs-keyword">return</span> [hsl[<span class="hljs-number">0</span>], c * <span class="hljs-number">100</span>, f * <span class="hljs-number">100</span>];
};

convert.hsv.hcg = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">hsv</span>) </span>{
	<span class="hljs-keyword">var</span> s = hsv[<span class="hljs-number">1</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> v = hsv[<span class="hljs-number">2</span>] / <span class="hljs-number">100</span>;

	<span class="hljs-keyword">var</span> c = s * v;
	<span class="hljs-keyword">var</span> f = <span class="hljs-number">0</span>;

	<span class="hljs-keyword">if</span> (c &lt; <span class="hljs-number">1.0</span>) {
		f = (v - c) / (<span class="hljs-number">1</span> - c);
	}

	<span class="hljs-keyword">return</span> [hsv[<span class="hljs-number">0</span>], c * <span class="hljs-number">100</span>, f * <span class="hljs-number">100</span>];
};

convert.hcg.rgb = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">hcg</span>) </span>{
	<span class="hljs-keyword">var</span> h = hcg[<span class="hljs-number">0</span>] / <span class="hljs-number">360</span>;
	<span class="hljs-keyword">var</span> c = hcg[<span class="hljs-number">1</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> g = hcg[<span class="hljs-number">2</span>] / <span class="hljs-number">100</span>;

	<span class="hljs-keyword">if</span> (c === <span class="hljs-number">0.0</span>) {
		<span class="hljs-keyword">return</span> [g * <span class="hljs-number">255</span>, g * <span class="hljs-number">255</span>, g * <span class="hljs-number">255</span>];
	}

	<span class="hljs-keyword">var</span> pure = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>];
	<span class="hljs-keyword">var</span> hi = (h % <span class="hljs-number">1</span>) * <span class="hljs-number">6</span>;
	<span class="hljs-keyword">var</span> v = hi % <span class="hljs-number">1</span>;
	<span class="hljs-keyword">var</span> w = <span class="hljs-number">1</span> - v;
	<span class="hljs-keyword">var</span> mg = <span class="hljs-number">0</span>;

	<span class="hljs-keyword">switch</span> (<span class="hljs-built_in">Math</span>.floor(hi)) {
		<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
			pure[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>; pure[<span class="hljs-number">1</span>] = v; pure[<span class="hljs-number">2</span>] = <span class="hljs-number">0</span>; <span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
			pure[<span class="hljs-number">0</span>] = w; pure[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>; pure[<span class="hljs-number">2</span>] = <span class="hljs-number">0</span>; <span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
			pure[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>; pure[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>; pure[<span class="hljs-number">2</span>] = v; <span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
			pure[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>; pure[<span class="hljs-number">1</span>] = w; pure[<span class="hljs-number">2</span>] = <span class="hljs-number">1</span>; <span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:
			pure[<span class="hljs-number">0</span>] = v; pure[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>; pure[<span class="hljs-number">2</span>] = <span class="hljs-number">1</span>; <span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">default</span>:
			pure[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>; pure[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>; pure[<span class="hljs-number">2</span>] = w;
	}

	mg = (<span class="hljs-number">1.0</span> - c) * g;

	<span class="hljs-keyword">return</span> [
		(c * pure[<span class="hljs-number">0</span>] + mg) * <span class="hljs-number">255</span>,
		(c * pure[<span class="hljs-number">1</span>] + mg) * <span class="hljs-number">255</span>,
		(c * pure[<span class="hljs-number">2</span>] + mg) * <span class="hljs-number">255</span>
	];
};

convert.hcg.hsv = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">hcg</span>) </span>{
	<span class="hljs-keyword">var</span> c = hcg[<span class="hljs-number">1</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> g = hcg[<span class="hljs-number">2</span>] / <span class="hljs-number">100</span>;

	<span class="hljs-keyword">var</span> v = c + g * (<span class="hljs-number">1.0</span> - c);
	<span class="hljs-keyword">var</span> f = <span class="hljs-number">0</span>;

	<span class="hljs-keyword">if</span> (v &gt; <span class="hljs-number">0.0</span>) {
		f = c / v;
	}

	<span class="hljs-keyword">return</span> [hcg[<span class="hljs-number">0</span>], f * <span class="hljs-number">100</span>, v * <span class="hljs-number">100</span>];
};

convert.hcg.hsl = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">hcg</span>) </span>{
	<span class="hljs-keyword">var</span> c = hcg[<span class="hljs-number">1</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> g = hcg[<span class="hljs-number">2</span>] / <span class="hljs-number">100</span>;

	<span class="hljs-keyword">var</span> l = g * (<span class="hljs-number">1.0</span> - c) + <span class="hljs-number">0.5</span> * c;
	<span class="hljs-keyword">var</span> s = <span class="hljs-number">0</span>;

	<span class="hljs-keyword">if</span> (l &gt; <span class="hljs-number">0.0</span> &amp;&amp; l &lt; <span class="hljs-number">0.5</span>) {
		s = c / (<span class="hljs-number">2</span> * l);
	} <span class="hljs-keyword">else</span>
	<span class="hljs-keyword">if</span> (l &gt;= <span class="hljs-number">0.5</span> &amp;&amp; l &lt; <span class="hljs-number">1.0</span>) {
		s = c / (<span class="hljs-number">2</span> * (<span class="hljs-number">1</span> - l));
	}

	<span class="hljs-keyword">return</span> [hcg[<span class="hljs-number">0</span>], s * <span class="hljs-number">100</span>, l * <span class="hljs-number">100</span>];
};

convert.hcg.hwb = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">hcg</span>) </span>{
	<span class="hljs-keyword">var</span> c = hcg[<span class="hljs-number">1</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> g = hcg[<span class="hljs-number">2</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> v = c + g * (<span class="hljs-number">1.0</span> - c);
	<span class="hljs-keyword">return</span> [hcg[<span class="hljs-number">0</span>], (v - c) * <span class="hljs-number">100</span>, (<span class="hljs-number">1</span> - v) * <span class="hljs-number">100</span>];
};

convert.hwb.hcg = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">hwb</span>) </span>{
	<span class="hljs-keyword">var</span> w = hwb[<span class="hljs-number">1</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> b = hwb[<span class="hljs-number">2</span>] / <span class="hljs-number">100</span>;
	<span class="hljs-keyword">var</span> v = <span class="hljs-number">1</span> - b;
	<span class="hljs-keyword">var</span> c = v - w;
	<span class="hljs-keyword">var</span> g = <span class="hljs-number">0</span>;

	<span class="hljs-keyword">if</span> (c &lt; <span class="hljs-number">1</span>) {
		g = (v - c) / (<span class="hljs-number">1</span> - c);
	}

	<span class="hljs-keyword">return</span> [hwb[<span class="hljs-number">0</span>], c * <span class="hljs-number">100</span>, g * <span class="hljs-number">100</span>];
};

convert.apple.rgb = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">apple</span>) </span>{
	<span class="hljs-keyword">return</span> [(apple[<span class="hljs-number">0</span>] / <span class="hljs-number">65535</span>) * <span class="hljs-number">255</span>, (apple[<span class="hljs-number">1</span>] / <span class="hljs-number">65535</span>) * <span class="hljs-number">255</span>, (apple[<span class="hljs-number">2</span>] / <span class="hljs-number">65535</span>) * <span class="hljs-number">255</span>];
};

convert.rgb.apple = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">rgb</span>) </span>{
	<span class="hljs-keyword">return</span> [(rgb[<span class="hljs-number">0</span>] / <span class="hljs-number">255</span>) * <span class="hljs-number">65535</span>, (rgb[<span class="hljs-number">1</span>] / <span class="hljs-number">255</span>) * <span class="hljs-number">65535</span>, (rgb[<span class="hljs-number">2</span>] / <span class="hljs-number">255</span>) * <span class="hljs-number">65535</span>];
};

convert.gray.rgb = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">return</span> [args[<span class="hljs-number">0</span>] / <span class="hljs-number">100</span> * <span class="hljs-number">255</span>, args[<span class="hljs-number">0</span>] / <span class="hljs-number">100</span> * <span class="hljs-number">255</span>, args[<span class="hljs-number">0</span>] / <span class="hljs-number">100</span> * <span class="hljs-number">255</span>];
};

convert.gray.hsl = convert.gray.hsv = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">return</span> [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, args[<span class="hljs-number">0</span>]];
};

convert.gray.hwb = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">gray</span>) </span>{
	<span class="hljs-keyword">return</span> [<span class="hljs-number">0</span>, <span class="hljs-number">100</span>, gray[<span class="hljs-number">0</span>]];
};

convert.gray.cmyk = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">gray</span>) </span>{
	<span class="hljs-keyword">return</span> [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, gray[<span class="hljs-number">0</span>]];
};

convert.gray.lab = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">gray</span>) </span>{
	<span class="hljs-keyword">return</span> [gray[<span class="hljs-number">0</span>], <span class="hljs-number">0</span>, <span class="hljs-number">0</span>];
};

convert.gray.hex = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">gray</span>) </span>{
	<span class="hljs-keyword">var</span> val = <span class="hljs-built_in">Math</span>.round(gray[<span class="hljs-number">0</span>] / <span class="hljs-number">100</span> * <span class="hljs-number">255</span>) &amp; <span class="hljs-number">0xFF</span>;
	<span class="hljs-keyword">var</span> integer = (val &lt;&lt; <span class="hljs-number">16</span>) + (val &lt;&lt; <span class="hljs-number">8</span>) + val;

	<span class="hljs-keyword">var</span> string = integer.toString(<span class="hljs-number">16</span>).toUpperCase();
	<span class="hljs-keyword">return</span> <span class="hljs-string">'000000'</span>.substring(string.length) + string;
};

convert.rgb.gray = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">rgb</span>) </span>{
	<span class="hljs-keyword">var</span> val = (rgb[<span class="hljs-number">0</span>] + rgb[<span class="hljs-number">1</span>] + rgb[<span class="hljs-number">2</span>]) / <span class="hljs-number">3</span>;
	<span class="hljs-keyword">return</span> [val / <span class="hljs-number">255</span> * <span class="hljs-number">100</span>];
};

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
