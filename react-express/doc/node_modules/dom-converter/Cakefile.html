<!DOCTYPE html>
<html>
<head>
  <title>Cakefile</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/dom-converter/Cakefile";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>Cakefile</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">
exec = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>).exec
fs = <span class="hljs-built_in">require</span> <span class="hljs-string">'fs'</span>
sysPath = <span class="hljs-built_in">require</span> <span class="hljs-string">'path'</span>

task <span class="hljs-string">'compile:coffee'</span>, <span class="hljs-function">-&gt;</span>

	<span class="hljs-keyword">unless</span> fs.existsSync <span class="hljs-string">'./scripts/js'</span>

		fs.mkdirSync <span class="hljs-string">'./scripts/js'</span>

	exec <span class="hljs-string">'node ./node_modules/coffee-script/bin/coffee -bco ./scripts/js ./scripts/coffee'</span>,

		<span class="hljs-function"><span class="hljs-params">(error)</span> -&gt;</span>

			<span class="hljs-keyword">if</span> fs.existsSync <span class="hljs-string">'-p'</span>

				fs.rmdirSync <span class="hljs-string">'-p'</span>

			<span class="hljs-keyword">if</span> error?

				<span class="hljs-built_in">console</span>.log <span class="hljs-string">'Compile failed: '</span> + error

			<span class="hljs-keyword">return</span>

task <span class="hljs-string">'build'</span>, <span class="hljs-function">-&gt;</span>

	invoke <span class="hljs-string">'compile:coffee'</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>This is in place until we replace the test suite runner with popo</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">task <span class="hljs-string">'test'</span>, <span class="hljs-function">-&gt;</span>

	runTestsIn <span class="hljs-string">'scripts/coffee/test'</span>, <span class="hljs-string">'_prepare.coffee'</span><span class="hljs-function">

<span class="hljs-title">runInCoffee</span> = <span class="hljs-params">(path, cb)</span> -&gt;</span>

	exec <span class="hljs-string">'node ./node_modules/coffee-script/bin/coffee '</span> + path, cb<span class="hljs-function">

<span class="hljs-title">runTestsIn</span> = <span class="hljs-params">(shortPath, except)</span> -&gt;</span>

	fullPath = sysPath.resolve shortPath

	fs.readdir fullPath, <span class="hljs-function"><span class="hljs-params">(err, files)</span> -&gt;</span>

		<span class="hljs-keyword">if</span> err <span class="hljs-keyword">then</span> <span class="hljs-keyword">throw</span> Error err

		<span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files

			<span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> file <span class="hljs-keyword">is</span> except

			fullFilePath = sysPath.resolve(fullPath, file)
			shortFilePath = shortPath + <span class="hljs-string">'/'</span> + file

			<span class="hljs-keyword">if</span> sysPath.extname(file) <span class="hljs-keyword">is</span> <span class="hljs-string">'.coffee'</span>

				runAsTest shortFilePath, fullFilePath

			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> fs.statSync(fullFilePath).isDirectory()

				runTestsIn shortFilePath

		<span class="hljs-keyword">return</span>

didBeep = <span class="hljs-literal">no</span><span class="hljs-function">

<span class="hljs-title">runAsTest</span> = <span class="hljs-params">(shortPath, fullPath)</span> -&gt;</span>

	runInCoffee fullPath, <span class="hljs-function"><span class="hljs-params">(error, stdout, stderr)</span> -&gt;</span>

		output = <span class="hljs-string">'Running '</span> + shortPath + <span class="hljs-string">'\n'</span>

		<span class="hljs-keyword">if</span> stderr

			<span class="hljs-keyword">unless</span> didBeep

				`<span class="javascript"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">"\007"</span>)</span>`

				didBeep = <span class="hljs-literal">yes</span>

			output += <span class="hljs-string">'Error\n'</span> + stdout + stderr + <span class="hljs-string">'\n'</span>

		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> stdout

			output += <span class="hljs-string">'\n'</span> + stdout

		<span class="hljs-built_in">console</span>.log output
</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
