<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/dns-packet/index.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>index.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> types = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./types'</span>)
<span class="hljs-keyword">var</span> ip = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ip'</span>)
<span class="hljs-keyword">var</span> Buffer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'safe-buffer'</span>).Buffer

<span class="hljs-keyword">var</span> QUERY_FLAG = <span class="hljs-number">0</span>
<span class="hljs-keyword">var</span> RESPONSE_FLAG = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">15</span>
<span class="hljs-keyword">var</span> FLUSH_MASK = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">15</span>
<span class="hljs-keyword">var</span> NOT_FLUSH_MASK = ~FLUSH_MASK
<span class="hljs-keyword">var</span> QU_MASK = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">15</span>
<span class="hljs-keyword">var</span> NOT_QU_MASK = ~QU_MASK

<span class="hljs-keyword">var</span> name = {}

name.encode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">n, buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!buf) buf = Buffer.allocUnsafe(name.encodingLength(n))
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  <span class="hljs-keyword">var</span> list = n.split(<span class="hljs-string">'.'</span>)
  <span class="hljs-keyword">var</span> oldOffset = offset

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; list.length; i++) {
    <span class="hljs-keyword">var</span> len = buf.write(list[i], offset + <span class="hljs-number">1</span>)
    buf[offset] = len
    offset += len + <span class="hljs-number">1</span>
  }

  buf[offset++] = <span class="hljs-number">0</span>

  name.encode.bytes = offset - oldOffset
  <span class="hljs-keyword">return</span> buf
}

name.encode.bytes = <span class="hljs-number">0</span>

name.decode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  <span class="hljs-keyword">var</span> list = []
  <span class="hljs-keyword">var</span> oldOffset = offset
  <span class="hljs-keyword">var</span> len = buf[offset++]

  <span class="hljs-keyword">if</span> (len &gt;= <span class="hljs-number">0xc0</span>) {
    <span class="hljs-keyword">var</span> res = name.decode(buf, buf.readUInt16BE(offset - <span class="hljs-number">1</span>) - <span class="hljs-number">0xc000</span>)
    name.decode.bytes = <span class="hljs-number">2</span>
    <span class="hljs-keyword">return</span> res
  }

  <span class="hljs-keyword">while</span> (len) {
    <span class="hljs-keyword">if</span> (len &gt;= <span class="hljs-number">0xc0</span>) {
      list.push(name.decode(buf, buf.readUInt16BE(offset - <span class="hljs-number">1</span>) - <span class="hljs-number">0xc000</span>))
      offset++
      <span class="hljs-keyword">break</span>
    }

    list.push(buf.toString(<span class="hljs-string">'utf-8'</span>, offset, offset + len))
    offset += len
    len = buf[offset++]
  }

  name.decode.bytes = offset - oldOffset
  <span class="hljs-keyword">return</span> list.join(<span class="hljs-string">'.'</span>)
}

name.decode.bytes = <span class="hljs-number">0</span>

name.encodingLength = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">n</span>) </span>{
  <span class="hljs-keyword">return</span> Buffer.byteLength(n) + <span class="hljs-number">2</span>
}

<span class="hljs-keyword">var</span> string = {}

string.encode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">s, buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!buf) buf = Buffer.allocUnsafe(string.encodingLength(s))
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  <span class="hljs-keyword">var</span> len = buf.write(s, offset + <span class="hljs-number">1</span>)
  buf[offset] = len
  string.encode.bytes = len + <span class="hljs-number">1</span>
  <span class="hljs-keyword">return</span> buf
}

string.encode.bytes = <span class="hljs-number">0</span>

string.decode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  <span class="hljs-keyword">var</span> len = buf[offset]
  <span class="hljs-keyword">var</span> s = buf.toString(<span class="hljs-string">'utf-8'</span>, offset + <span class="hljs-number">1</span>, offset + <span class="hljs-number">1</span> + len)
  string.decode.bytes = len + <span class="hljs-number">1</span>
  <span class="hljs-keyword">return</span> s
}

string.decode.bytes = <span class="hljs-number">0</span>

string.encodingLength = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">s</span>) </span>{
  <span class="hljs-keyword">return</span> Buffer.byteLength(s) + <span class="hljs-number">1</span>
}

<span class="hljs-keyword">var</span> header = {}

header.encode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">h, buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!buf) buf = header.encodingLength(h)
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  <span class="hljs-keyword">var</span> flags = (h.flags || <span class="hljs-number">0</span>) &amp; <span class="hljs-number">32767</span>
  <span class="hljs-keyword">var</span> type = h.type === <span class="hljs-string">'response'</span> ? RESPONSE_FLAG : QUERY_FLAG

  buf.writeUInt16BE(h.id || <span class="hljs-number">0</span>, offset)
  buf.writeUInt16BE(flags | type, offset + <span class="hljs-number">2</span>)
  buf.writeUInt16BE(h.questions.length, offset + <span class="hljs-number">4</span>)
  buf.writeUInt16BE(h.answers.length, offset + <span class="hljs-number">6</span>)
  buf.writeUInt16BE(h.authorities.length, offset + <span class="hljs-number">8</span>)
  buf.writeUInt16BE(h.additionals.length, offset + <span class="hljs-number">10</span>)

  <span class="hljs-keyword">return</span> buf
}

header.encode.bytes = <span class="hljs-number">12</span>

header.decode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>
  <span class="hljs-keyword">if</span> (buf.length &lt; <span class="hljs-number">12</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Header must be 12 bytes'</span>)
  <span class="hljs-keyword">var</span> flags = buf.readUInt16BE(offset + <span class="hljs-number">2</span>)

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">id</span>: buf.readUInt16BE(offset),
    <span class="hljs-attr">type</span>: flags &amp; RESPONSE_FLAG ? <span class="hljs-string">'response'</span> : <span class="hljs-string">'query'</span>,
    <span class="hljs-attr">flags</span>: flags &amp; <span class="hljs-number">32767</span>,
    <span class="hljs-attr">questions</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(buf.readUInt16BE(offset + <span class="hljs-number">4</span>)),
    <span class="hljs-attr">answers</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(buf.readUInt16BE(offset + <span class="hljs-number">6</span>)),
    <span class="hljs-attr">authorities</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(buf.readUInt16BE(offset + <span class="hljs-number">8</span>)),
    <span class="hljs-attr">additionals</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(buf.readUInt16BE(offset + <span class="hljs-number">10</span>))
  }
}

header.decode.bytes = <span class="hljs-number">12</span>

header.encodingLength = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">h</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-number">12</span>
}

<span class="hljs-keyword">var</span> runknown = exports.unknown = {}

runknown.encode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data, buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!buf) buf = Buffer.allocUnsafe(runknown.encodingLength(data))
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  buf.writeUInt16BE(data.length, offset)
  data.copy(buf, offset + <span class="hljs-number">2</span>)

  runknown.encode.bytes = data.length + <span class="hljs-number">2</span>
  <span class="hljs-keyword">return</span> buf
}

runknown.encode.bytes = <span class="hljs-number">0</span>

runknown.decode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  <span class="hljs-keyword">var</span> len = buf.readUInt16BE(offset)
  <span class="hljs-keyword">var</span> data = buf.slice(offset + <span class="hljs-number">2</span>, offset + <span class="hljs-number">2</span> + len)
  runknown.decode.bytes = len + <span class="hljs-number">2</span>
  <span class="hljs-keyword">return</span> data
}

runknown.decode.bytes = <span class="hljs-number">0</span>

runknown.encodingLength = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
  <span class="hljs-keyword">return</span> data.length + <span class="hljs-number">2</span>
}

<span class="hljs-keyword">var</span> rtxt = exports.txt = exports.null = {}
<span class="hljs-keyword">var</span> rnull = rtxt

rtxt.encode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data, buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!buf) buf = Buffer.allocUnsafe(rtxt.encodingLength(data))
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> data === <span class="hljs-string">'string'</span>) data = Buffer.from(data)
  <span class="hljs-keyword">if</span> (!data) data = Buffer.allocUnsafe(<span class="hljs-number">0</span>)

  <span class="hljs-keyword">var</span> oldOffset = offset
  offset += <span class="hljs-number">2</span>

  <span class="hljs-keyword">var</span> len = data.length
  data.copy(buf, offset, <span class="hljs-number">0</span>, len)
  offset += len

  buf.writeUInt16BE(offset - oldOffset - <span class="hljs-number">2</span>, oldOffset)
  rtxt.encode.bytes = offset - oldOffset
  <span class="hljs-keyword">return</span> buf
}

rtxt.encode.bytes = <span class="hljs-number">0</span>

rtxt.decode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>
  <span class="hljs-keyword">var</span> oldOffset = offset
  <span class="hljs-keyword">var</span> len = buf.readUInt16BE(offset)

  offset += <span class="hljs-number">2</span>

  <span class="hljs-keyword">var</span> data = buf.slice(offset, offset + len)
  offset += len

  rtxt.decode.bytes = offset - oldOffset
  <span class="hljs-keyword">return</span> data
}

rtxt.decode.bytes = <span class="hljs-number">0</span>

rtxt.encodingLength = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
  <span class="hljs-keyword">if</span> (!data) <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>
  <span class="hljs-keyword">return</span> (Buffer.isBuffer(data) ? data.length : Buffer.byteLength(data)) + <span class="hljs-number">2</span>
}

<span class="hljs-keyword">var</span> rhinfo = exports.hinfo = {}

rhinfo.encode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data, buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!buf) buf = Buffer.allocUnsafe(rhinfo.encodingLength(data))
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  <span class="hljs-keyword">var</span> oldOffset = offset
  offset += <span class="hljs-number">2</span>
  string.encode(data.cpu, buf, offset)
  offset += string.encode.bytes
  string.encode(data.os, buf, offset)
  offset += string.encode.bytes
  buf.writeUInt16BE(offset - oldOffset - <span class="hljs-number">2</span>, oldOffset)
  rhinfo.encode.bytes = offset - oldOffset
  <span class="hljs-keyword">return</span> buf
}

rhinfo.encode.bytes = <span class="hljs-number">0</span>

rhinfo.decode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  <span class="hljs-keyword">var</span> oldOffset = offset

  <span class="hljs-keyword">var</span> data = {}
  offset += <span class="hljs-number">2</span>
  data.cpu = string.decode(buf, offset)
  offset += string.decode.bytes
  data.os = string.decode(buf, offset)
  offset += string.decode.bytes
  rhinfo.decode.bytes = offset - oldOffset
  <span class="hljs-keyword">return</span> data
}

rhinfo.decode.bytes = <span class="hljs-number">0</span>

rhinfo.encodingLength = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
  <span class="hljs-keyword">return</span> string.encodingLength(data.cpu) + string.encodingLength(data.os) + <span class="hljs-number">2</span>
}

<span class="hljs-keyword">var</span> rptr = exports.ptr = {}
<span class="hljs-keyword">var</span> rcname = exports.cname = rptr
<span class="hljs-keyword">var</span> rdname = exports.dname = rptr

rptr.encode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data, buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!buf) buf = Buffer.allocUnsafe(rptr.encodingLength(data))
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  name.encode(data, buf, offset + <span class="hljs-number">2</span>)
  buf.writeUInt16BE(name.encode.bytes, offset)
  rptr.encode.bytes = name.encode.bytes + <span class="hljs-number">2</span>
  <span class="hljs-keyword">return</span> buf
}

rptr.encode.bytes = <span class="hljs-number">0</span>

rptr.decode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  <span class="hljs-keyword">var</span> data = name.decode(buf, offset + <span class="hljs-number">2</span>)
  rptr.decode.bytes = name.decode.bytes + <span class="hljs-number">2</span>
  <span class="hljs-keyword">return</span> data
}

rptr.decode.bytes = <span class="hljs-number">0</span>

rptr.encodingLength = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
  <span class="hljs-keyword">return</span> name.encodingLength(data) + <span class="hljs-number">2</span>
}

<span class="hljs-keyword">var</span> rsrv = exports.srv = {}

rsrv.encode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data, buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!buf) buf = Buffer.allocUnsafe(rsrv.encodingLength(data))
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  buf.writeUInt16BE(data.priority || <span class="hljs-number">0</span>, offset + <span class="hljs-number">2</span>)
  buf.writeUInt16BE(data.weight || <span class="hljs-number">0</span>, offset + <span class="hljs-number">4</span>)
  buf.writeUInt16BE(data.port || <span class="hljs-number">0</span>, offset + <span class="hljs-number">6</span>)
  name.encode(data.target, buf, offset + <span class="hljs-number">8</span>)

  <span class="hljs-keyword">var</span> len = name.encode.bytes + <span class="hljs-number">6</span>
  buf.writeUInt16BE(len, offset)

  rsrv.encode.bytes = len + <span class="hljs-number">2</span>
  <span class="hljs-keyword">return</span> buf
}

rsrv.encode.bytes = <span class="hljs-number">0</span>

rsrv.decode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  <span class="hljs-keyword">var</span> len = buf.readUInt16BE(offset)

  <span class="hljs-keyword">var</span> data = {}
  data.priority = buf.readUInt16BE(offset + <span class="hljs-number">2</span>)
  data.weight = buf.readUInt16BE(offset + <span class="hljs-number">4</span>)
  data.port = buf.readUInt16BE(offset + <span class="hljs-number">6</span>)
  data.target = name.decode(buf, offset + <span class="hljs-number">8</span>)

  rsrv.decode.bytes = len + <span class="hljs-number">2</span>
  <span class="hljs-keyword">return</span> data
}

rsrv.decode.bytes = <span class="hljs-number">0</span>

rsrv.encodingLength = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-number">8</span> + name.encodingLength(data.target)
}

<span class="hljs-keyword">var</span> rcaa = exports.caa = {}

rcaa.ISSUER_CRITICAL = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">7</span>

rcaa.encode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data, buf, offset</span>) </span>{
  <span class="hljs-keyword">var</span> len = rcaa.encodingLength(data)

  <span class="hljs-keyword">if</span> (!buf) buf = Buffer.allocUnsafe(rcaa.encodingLength(data))
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  <span class="hljs-keyword">if</span> (data.issuerCritical) {
    data.flags = rcaa.ISSUER_CRITICAL
  }

  buf.writeUInt16BE(len - <span class="hljs-number">2</span>, offset)
  offset += <span class="hljs-number">2</span>
  buf.writeUInt8(data.flags || <span class="hljs-number">0</span>, offset)
  offset += <span class="hljs-number">1</span>
  string.encode(data.tag, buf, offset)
  offset += string.encode.bytes
  buf.write(data.value, offset)
  offset += Buffer.byteLength(data.value)

  rcaa.encode.bytes = len
  <span class="hljs-keyword">return</span> buf
}

rcaa.encode.bytes = <span class="hljs-number">0</span>

rcaa.decode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  <span class="hljs-keyword">var</span> len = buf.readUInt16BE(offset)
  offset += <span class="hljs-number">2</span>

  <span class="hljs-keyword">var</span> oldOffset = offset
  <span class="hljs-keyword">var</span> data = {}
  data.flags = buf.readUInt8(offset)
  offset += <span class="hljs-number">1</span>
  data.tag = string.decode(buf, offset)
  offset += string.decode.bytes
  data.value = buf.toString(<span class="hljs-string">'utf-8'</span>, offset, oldOffset + len)

  data.issuerCritical = !!(data.flags &amp; rcaa.ISSUER_CRITICAL)

  rcaa.decode.bytes = len + <span class="hljs-number">2</span>

  <span class="hljs-keyword">return</span> data
}

rcaa.decode.bytes = <span class="hljs-number">0</span>

rcaa.encodingLength = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
  <span class="hljs-keyword">return</span> string.encodingLength(data.tag) + string.encodingLength(data.value) + <span class="hljs-number">2</span>
}

<span class="hljs-keyword">var</span> ra = exports.a = {}

ra.encode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">host, buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!buf) buf = Buffer.allocUnsafe(ra.encodingLength(host))
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  buf.writeUInt16BE(<span class="hljs-number">4</span>, offset)
  offset += <span class="hljs-number">2</span>
  ip.toBuffer(host, buf, offset)
  ra.encode.bytes = <span class="hljs-number">6</span>
  <span class="hljs-keyword">return</span> buf
}

ra.encode.bytes = <span class="hljs-number">0</span>

ra.decode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  offset += <span class="hljs-number">2</span>
  <span class="hljs-keyword">var</span> host = ip.toString(buf, offset, <span class="hljs-number">4</span>)
  ra.decode.bytes = <span class="hljs-number">6</span>
  <span class="hljs-keyword">return</span> host
}

ra.decode.bytes = <span class="hljs-number">0</span>

ra.encodingLength = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">host</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-number">6</span>
}

<span class="hljs-keyword">var</span> raaaa = exports.aaaa = {}

raaaa.encode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">host, buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!buf) buf = Buffer.allocUnsafe(raaaa.encodingLength(host))
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  buf.writeUInt16BE(<span class="hljs-number">16</span>, offset)
  offset += <span class="hljs-number">2</span>
  ip.toBuffer(host, buf, offset)
  raaaa.encode.bytes = <span class="hljs-number">18</span>
  <span class="hljs-keyword">return</span> buf
}

raaaa.encode.bytes = <span class="hljs-number">0</span>

raaaa.decode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  offset += <span class="hljs-number">2</span>
  <span class="hljs-keyword">var</span> host = ip.toString(buf, offset, <span class="hljs-number">16</span>)
  raaaa.decode.bytes = <span class="hljs-number">18</span>
  <span class="hljs-keyword">return</span> host
}

raaaa.decode.bytes = <span class="hljs-number">0</span>

raaaa.encodingLength = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">host</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-number">18</span>
}

<span class="hljs-keyword">var</span> renc = exports.record = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">type</span>) </span>{
  <span class="hljs-keyword">switch</span> (type.toUpperCase()) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'A'</span>: <span class="hljs-keyword">return</span> ra
    <span class="hljs-keyword">case</span> <span class="hljs-string">'PTR'</span>: <span class="hljs-keyword">return</span> rptr
    <span class="hljs-keyword">case</span> <span class="hljs-string">'CNAME'</span>: <span class="hljs-keyword">return</span> rcname
    <span class="hljs-keyword">case</span> <span class="hljs-string">'DNAME'</span>: <span class="hljs-keyword">return</span> rdname
    <span class="hljs-keyword">case</span> <span class="hljs-string">'TXT'</span>: <span class="hljs-keyword">return</span> rtxt
    <span class="hljs-keyword">case</span> <span class="hljs-string">'NULL'</span>: <span class="hljs-keyword">return</span> rnull
    <span class="hljs-keyword">case</span> <span class="hljs-string">'AAAA'</span>: <span class="hljs-keyword">return</span> raaaa
    <span class="hljs-keyword">case</span> <span class="hljs-string">'SRV'</span>: <span class="hljs-keyword">return</span> rsrv
    <span class="hljs-keyword">case</span> <span class="hljs-string">'HINFO'</span>: <span class="hljs-keyword">return</span> rhinfo
    <span class="hljs-keyword">case</span> <span class="hljs-string">'CAA'</span>: <span class="hljs-keyword">return</span> rcaa
  }
  <span class="hljs-keyword">return</span> runknown
}

<span class="hljs-keyword">var</span> answer = exports.answer = {}

answer.encode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!buf) buf = Buffer.allocUnsafe(answer.encodingLength(a))
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  <span class="hljs-keyword">var</span> oldOffset = offset

  name.encode(a.name, buf, offset)
  offset += name.encode.bytes

  buf.writeUInt16BE(types.toType(a.type), offset)

  <span class="hljs-keyword">var</span> klass = a.class === <span class="hljs-literal">undefined</span> ? <span class="hljs-number">1</span> : a.class
  <span class="hljs-keyword">if</span> (a.flush) klass |= FLUSH_MASK <span class="hljs-comment">// the 1st bit of the class is the flush bit</span>
  buf.writeUInt16BE(klass, offset + <span class="hljs-number">2</span>)

  buf.writeUInt32BE(a.ttl || <span class="hljs-number">0</span>, offset + <span class="hljs-number">4</span>)

  <span class="hljs-keyword">var</span> enc = renc(a.type)
  enc.encode(a.data, buf, offset + <span class="hljs-number">8</span>)
  offset += <span class="hljs-number">8</span> + enc.encode.bytes

  answer.encode.bytes = offset - oldOffset
  <span class="hljs-keyword">return</span> buf
}

answer.encode.bytes = <span class="hljs-number">0</span>

answer.decode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  <span class="hljs-keyword">var</span> a = {}
  <span class="hljs-keyword">var</span> oldOffset = offset

  a.name = name.decode(buf, offset)
  offset += name.decode.bytes
  a.type = types.toString(buf.readUInt16BE(offset))
  a.class = buf.readUInt16BE(offset + <span class="hljs-number">2</span>)
  a.ttl = buf.readUInt32BE(offset + <span class="hljs-number">4</span>)

  a.flush = !!(a.class &amp; FLUSH_MASK)
  <span class="hljs-keyword">if</span> (a.flush) a.class &amp;= NOT_FLUSH_MASK

  <span class="hljs-keyword">var</span> enc = renc(a.type)
  a.data = enc.decode(buf, offset + <span class="hljs-number">8</span>)
  offset += <span class="hljs-number">8</span> + enc.decode.bytes

  answer.decode.bytes = offset - oldOffset
  <span class="hljs-keyword">return</span> a
}

answer.decode.bytes = <span class="hljs-number">0</span>

answer.encodingLength = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a</span>) </span>{
  <span class="hljs-keyword">return</span> name.encodingLength(a.name) + <span class="hljs-number">8</span> + renc(a.type).encodingLength(a.data)
}

<span class="hljs-keyword">var</span> question = exports.question = {}

question.encode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">q, buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!buf) buf = Buffer.allocUnsafe(question.encodingLength(q))
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  <span class="hljs-keyword">var</span> oldOffset = offset

  name.encode(q.name, buf, offset)
  offset += name.encode.bytes

  buf.writeUInt16BE(types.toType(q.type), offset)
  offset += <span class="hljs-number">2</span>

  buf.writeUInt16BE(q.class === <span class="hljs-literal">undefined</span> ? <span class="hljs-number">1</span> : q.class, offset)
  offset += <span class="hljs-number">2</span>

  question.encode.bytes = offset - oldOffset
  <span class="hljs-keyword">return</span> q
}

question.encode.bytes = <span class="hljs-number">0</span>

question.decode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  <span class="hljs-keyword">var</span> oldOffset = offset
  <span class="hljs-keyword">var</span> q = {}

  q.name = name.decode(buf, offset)
  offset += name.decode.bytes

  q.type = types.toString(buf.readUInt16BE(offset))
  offset += <span class="hljs-number">2</span>

  q.class = buf.readUInt16BE(offset)
  offset += <span class="hljs-number">2</span>

  <span class="hljs-keyword">var</span> qu = !!(q.class &amp; QU_MASK)
  <span class="hljs-keyword">if</span> (qu) q.class &amp;= NOT_QU_MASK

  question.decode.bytes = offset - oldOffset
  <span class="hljs-keyword">return</span> q
}

question.decode.bytes = <span class="hljs-number">0</span>

question.encodingLength = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">q</span>) </span>{
  <span class="hljs-keyword">return</span> name.encodingLength(q.name) + <span class="hljs-number">4</span>
}

exports.AUTHORITATIVE_ANSWER = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">10</span>
exports.TRUNCATED_RESPONSE = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">9</span>
exports.RECURSION_DESIRED = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">8</span>
exports.RECURSION_AVAILABLE = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">7</span>
exports.AUTHENTIC_DATA = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">5</span>
exports.CHECKING_DISABLED = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">4</span>

exports.encode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">result, buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!buf) buf = Buffer.allocUnsafe(exports.encodingLength(result))
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  <span class="hljs-keyword">var</span> oldOffset = offset

  <span class="hljs-keyword">if</span> (!result.questions) result.questions = []
  <span class="hljs-keyword">if</span> (!result.answers) result.answers = []
  <span class="hljs-keyword">if</span> (!result.authorities) result.authorities = []
  <span class="hljs-keyword">if</span> (!result.additionals) result.additionals = []

  header.encode(result, buf, offset)
  offset += header.encode.bytes

  offset = encodeList(result.questions, question, buf, offset)
  offset = encodeList(result.answers, answer, buf, offset)
  offset = encodeList(result.authorities, answer, buf, offset)
  offset = encodeList(result.additionals, answer, buf, offset)

  exports.encode.bytes = offset - oldOffset

  <span class="hljs-keyword">return</span> buf
}

exports.encode.bytes = <span class="hljs-number">0</span>

exports.decode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">buf, offset</span>) </span>{
  <span class="hljs-keyword">if</span> (!offset) offset = <span class="hljs-number">0</span>

  <span class="hljs-keyword">var</span> oldOffset = offset
  <span class="hljs-keyword">var</span> result = header.decode(buf, offset)
  offset += header.decode.bytes

  offset = decodeList(result.questions, question, buf, offset)
  offset = decodeList(result.answers, answer, buf, offset)
  offset = decodeList(result.authorities, answer, buf, offset)
  offset = decodeList(result.additionals, answer, buf, offset)

  exports.decode.bytes = offset - oldOffset

  <span class="hljs-keyword">return</span> result
}

exports.decode.bytes = <span class="hljs-number">0</span>

exports.encodingLength = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">result</span>) </span>{
  <span class="hljs-keyword">return</span> header.encodingLength(result) +
    encodingLengthList(result.questions || [], question) +
    encodingLengthList(result.answers || [], answer) +
    encodingLengthList(result.authorities || [], answer) +
    encodingLengthList(result.additionals || [], answer)
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">encodingLengthList</span> (<span class="hljs-params">list, enc</span>) </span>{
  <span class="hljs-keyword">var</span> len = <span class="hljs-number">0</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; list.length; i++) len += enc.encodingLength(list[i])
  <span class="hljs-keyword">return</span> len
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">encodeList</span> (<span class="hljs-params">list, enc, buf, offset</span>) </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; list.length; i++) {
    enc.encode(list[i], buf, offset)
    offset += enc.encode.bytes
  }
  <span class="hljs-keyword">return</span> offset
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decodeList</span> (<span class="hljs-params">list, enc, buf, offset</span>) </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; list.length; i++) {
    list[i] = enc.decode(buf, offset)
    offset += enc.decode.bytes
  }
  <span class="hljs-keyword">return</span> offset
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
