<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/babel-eslint/index.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>index.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> babylonToEspree = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./babylon-to-espree"</span>);
<span class="hljs-keyword">var</span> Module          = <span class="hljs-built_in">require</span>(<span class="hljs-string">"module"</span>);
<span class="hljs-keyword">var</span> path            = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);
<span class="hljs-keyword">var</span> parse           = <span class="hljs-built_in">require</span>(<span class="hljs-string">"babylon"</span>).parse;
<span class="hljs-keyword">var</span> t               = <span class="hljs-built_in">require</span>(<span class="hljs-string">"babel-types"</span>);
<span class="hljs-keyword">var</span> tt              = <span class="hljs-built_in">require</span>(<span class="hljs-string">"babylon"</span>).tokTypes;
<span class="hljs-keyword">var</span> traverse        = <span class="hljs-built_in">require</span>(<span class="hljs-string">"babel-traverse"</span>).default;
<span class="hljs-keyword">var</span> codeFrame       = <span class="hljs-built_in">require</span>(<span class="hljs-string">"babel-code-frame"</span>);

<span class="hljs-keyword">var</span> hasPatched = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">var</span> eslintOptions = {};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getModules</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">try</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>avoid importing a local copy of eslint, try to find a peer dependency</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> eslintLoc = Module._resolveFilename(<span class="hljs-string">"eslint"</span>, <span class="hljs-built_in">module</span>.parent);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-keyword">try</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>avoids breaking in jest where module.parent is undefined</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      eslintLoc = <span class="hljs-built_in">require</span>.resolve(<span class="hljs-string">"eslint"</span>);
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">ReferenceError</span>(<span class="hljs-string">"couldn't resolve eslint"</span>);
    }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>get modules relative to what eslint will load</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> eslintMod = <span class="hljs-keyword">new</span> Module(eslintLoc);
  eslintMod.filename = eslintLoc;
  eslintMod.paths = Module._nodeModulePaths(path.dirname(eslintLoc));

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">var</span> escope = eslintMod.require(<span class="hljs-string">"eslint-scope"</span>);
    <span class="hljs-keyword">var</span> Definition = eslintMod.require(<span class="hljs-string">"eslint-scope/lib/definition"</span>).Definition;
    <span class="hljs-keyword">var</span> referencer = eslintMod.require(<span class="hljs-string">"eslint-scope/lib/referencer"</span>);
  } <span class="hljs-keyword">catch</span> (err) {
    escope  = eslintMod.require(<span class="hljs-string">"escope"</span>);
    Definition = eslintMod.require(<span class="hljs-string">"escope/lib/definition"</span>).Definition;
    referencer = eslintMod.require(<span class="hljs-string">"escope/lib/referencer"</span>);
  }

  <span class="hljs-keyword">var</span> estraverse = eslintMod.require(<span class="hljs-string">"estraverse"</span>);

  <span class="hljs-keyword">if</span> (referencer.__esModule) referencer = referencer.default;

  <span class="hljs-keyword">return</span> {
    Definition,
    escope,
    estraverse,
    referencer,
  };
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">monkeypatch</span>(<span class="hljs-params">modules</span>) </span>{
  <span class="hljs-keyword">var</span> Definition = modules.Definition;
  <span class="hljs-keyword">var</span> escope = modules.escope;
  <span class="hljs-keyword">var</span> estraverse = modules.estraverse;
  <span class="hljs-keyword">var</span> referencer = modules.referencer;

  <span class="hljs-built_in">Object</span>.assign(estraverse.VisitorKeys, t.VISITOR_KEYS);
  estraverse.VisitorKeys.MethodDefinition.push(<span class="hljs-string">"decorators"</span>);
  estraverse.VisitorKeys.Property.push(<span class="hljs-string">"decorators"</span>);

  <span class="hljs-keyword">var</span> analyze = escope.analyze;
  escope.analyze = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ast, opts</span>) </span>{
    opts.ecmaVersion = eslintOptions.ecmaVersion;
    opts.sourceType = eslintOptions.sourceType;
    <span class="hljs-keyword">if</span> (eslintOptions.globalReturn !== <span class="hljs-literal">undefined</span>) {
      opts.nodejsScope = eslintOptions.globalReturn;
    }

    <span class="hljs-keyword">var</span> results = analyze.call(<span class="hljs-keyword">this</span>, ast, opts);
    <span class="hljs-keyword">return</span> results;
  };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>if there are decorators, then visit each</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">visitDecorators</span>(<span class="hljs-params">node</span>) </span>{
    <span class="hljs-keyword">if</span> (!node.decorators) {
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; node.decorators.length; i++) {
      <span class="hljs-keyword">if</span> (node.decorators[i].expression) {
        <span class="hljs-keyword">this</span>.visit(node.decorators[i]);
      }
    }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>iterate through part of t.VISITOR_KEYS</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> flowFlippedAliasKeys = t.FLIPPED_ALIAS_KEYS.Flow.concat([
    <span class="hljs-string">"ArrayPattern"</span>,
    <span class="hljs-string">"ClassDeclaration"</span>,
    <span class="hljs-string">"ClassExpression"</span>,
    <span class="hljs-string">"FunctionDeclaration"</span>,
    <span class="hljs-string">"FunctionExpression"</span>,
    <span class="hljs-string">"Identifier"</span>,
    <span class="hljs-string">"ObjectPattern"</span>,
    <span class="hljs-string">"RestElement"</span>
  ]);
  <span class="hljs-keyword">var</span> visitorKeysMap = <span class="hljs-built_in">Object</span>.keys(t.VISITOR_KEYS).reduce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">acc, key</span>) </span>{
    <span class="hljs-keyword">var</span> value = t.VISITOR_KEYS[key];
    <span class="hljs-keyword">if</span> (flowFlippedAliasKeys.indexOf(value) === <span class="hljs-number">-1</span>) {
      acc[key] = value;
    }
    <span class="hljs-keyword">return</span> acc;
  }, {});

  <span class="hljs-keyword">var</span> propertyTypes = {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>loops</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    callProperties: { <span class="hljs-attr">type</span>: <span class="hljs-string">"loop"</span>, <span class="hljs-attr">values</span>: [<span class="hljs-string">"value"</span>] },
    <span class="hljs-attr">indexers</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"loop"</span>, <span class="hljs-attr">values</span>: [<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>] },
    <span class="hljs-attr">properties</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"loop"</span>, <span class="hljs-attr">values</span>: [<span class="hljs-string">"argument"</span>, <span class="hljs-string">"value"</span>] },
    <span class="hljs-attr">types</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"loop"</span> },
    <span class="hljs-attr">params</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"loop"</span> },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>single property</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    argument: { <span class="hljs-attr">type</span>: <span class="hljs-string">"single"</span> },
    <span class="hljs-attr">elementType</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"single"</span> },
    <span class="hljs-attr">qualification</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"single"</span> },
    <span class="hljs-attr">rest</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"single"</span> },
    <span class="hljs-attr">returnType</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"single"</span> },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>others</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    typeAnnotation: { <span class="hljs-attr">type</span>: <span class="hljs-string">"typeAnnotation"</span> },
    <span class="hljs-attr">typeParameters</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"typeParameters"</span> },
    <span class="hljs-attr">id</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"id"</span> }
  };

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">visitTypeAnnotation</span>(<span class="hljs-params">node</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>get property to check (params, id, etc...)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> visitorValues = visitorKeysMap[node.type];
    <span class="hljs-keyword">if</span> (!visitorValues) {
      <span class="hljs-keyword">return</span>;
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>can have multiple properties</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; visitorValues.length; i++) {
      <span class="hljs-keyword">var</span> visitorValue = visitorValues[i];
      <span class="hljs-keyword">var</span> propertyType = propertyTypes[visitorValue];
      <span class="hljs-keyword">var</span> nodeProperty = node[visitorValue];
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>check if property or type is defined</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span> (propertyType == <span class="hljs-literal">null</span> || nodeProperty == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">continue</span>;
      }
      <span class="hljs-keyword">if</span> (propertyType.type === <span class="hljs-string">"loop"</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; nodeProperty.length; j++) {
          <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(propertyType.values)) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>; k &lt; propertyType.values.length; k++) {
              <span class="hljs-keyword">var</span> loopPropertyNode = nodeProperty[j][propertyType.values[k]];
              <span class="hljs-keyword">if</span> (loopPropertyNode) {
                checkIdentifierOrVisit.call(<span class="hljs-keyword">this</span>, loopPropertyNode);
              }
            }
          } <span class="hljs-keyword">else</span> {
            checkIdentifierOrVisit.call(<span class="hljs-keyword">this</span>, nodeProperty[j]);
          }
        }
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (propertyType.type === <span class="hljs-string">"single"</span>) {
        checkIdentifierOrVisit.call(<span class="hljs-keyword">this</span>, nodeProperty);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (propertyType.type === <span class="hljs-string">"typeAnnotation"</span>) {
        visitTypeAnnotation.call(<span class="hljs-keyword">this</span>, node.typeAnnotation);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (propertyType.type === <span class="hljs-string">"typeParameters"</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> l = <span class="hljs-number">0</span>; l &lt; node.typeParameters.params.length; l++) {
          checkIdentifierOrVisit.call(<span class="hljs-keyword">this</span>, node.typeParameters.params[l]);
        }
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (propertyType.type === <span class="hljs-string">"id"</span>) {
        <span class="hljs-keyword">if</span> (node.id.type === <span class="hljs-string">"Identifier"</span>) {
          checkIdentifierOrVisit.call(<span class="hljs-keyword">this</span>, node.id);
        } <span class="hljs-keyword">else</span> {
          visitTypeAnnotation.call(<span class="hljs-keyword">this</span>, node.id);
        }
      }
    }
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkIdentifierOrVisit</span>(<span class="hljs-params">node</span>) </span>{
    <span class="hljs-keyword">if</span> (node.typeAnnotation) {
      visitTypeAnnotation.call(<span class="hljs-keyword">this</span>, node.typeAnnotation);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node.type === <span class="hljs-string">"Identifier"</span>) {
      <span class="hljs-keyword">this</span>.visit(node);
    } <span class="hljs-keyword">else</span> {
      visitTypeAnnotation.call(<span class="hljs-keyword">this</span>, node);
    }
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nestTypeParamScope</span>(<span class="hljs-params">manager, node</span>) </span>{
    <span class="hljs-keyword">var</span> parentScope = manager.__currentScope;
    <span class="hljs-keyword">var</span> scope = <span class="hljs-keyword">new</span> escope.Scope(manager, <span class="hljs-string">"type-parameters"</span>, parentScope, node, <span class="hljs-literal">false</span>);
    manager.__nestScope(scope);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; node.typeParameters.params.length; j++) {
      <span class="hljs-keyword">var</span> name = node.typeParameters.params[j];
      scope.__define(name, <span class="hljs-keyword">new</span> Definition(<span class="hljs-string">"TypeParameter"</span>, name, name));
      <span class="hljs-keyword">if</span> (name.typeAnnotation) {
        checkIdentifierOrVisit.call(<span class="hljs-keyword">this</span>, name);
      }
    }
    scope.__define = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> parentScope.__define.apply(parentScope, <span class="hljs-built_in">arguments</span>);
    };
    <span class="hljs-keyword">return</span> scope;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>visit decorators that are in: ClassDeclaration / ClassExpression</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> visitClass = referencer.prototype.visitClass;
  referencer.prototype.visitClass = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">node</span>) </span>{
    visitDecorators.call(<span class="hljs-keyword">this</span>, node);
    <span class="hljs-keyword">var</span> typeParamScope;
    <span class="hljs-keyword">if</span> (node.typeParameters) {
      typeParamScope = nestTypeParamScope.call(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.scopeManager, node);
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>visit flow type: ClassImplements</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (node.implements) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; node.implements.length; i++) {
        checkIdentifierOrVisit.call(<span class="hljs-keyword">this</span>, node.implements[i]);
      }
    }
    <span class="hljs-keyword">if</span> (node.superTypeParameters) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>; k &lt; node.superTypeParameters.params.length; k++) {
        checkIdentifierOrVisit.call(<span class="hljs-keyword">this</span>, node.superTypeParameters.params[k]);
      }
    }
    visitClass.call(<span class="hljs-keyword">this</span>, node);
    <span class="hljs-keyword">if</span> (typeParamScope) {
      <span class="hljs-keyword">this</span>.close(node);
    }
  };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>visit decorators that are in: Property / MethodDefinition</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> visitProperty = referencer.prototype.visitProperty;
  referencer.prototype.visitProperty = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">node</span>) </span>{
    <span class="hljs-keyword">if</span> (node.value &amp;&amp; node.value.type === <span class="hljs-string">"TypeCastExpression"</span>) {
      visitTypeAnnotation.call(<span class="hljs-keyword">this</span>, node.value);
    }
    visitDecorators.call(<span class="hljs-keyword">this</span>, node);
    visitProperty.call(<span class="hljs-keyword">this</span>, node);
  };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>visit ClassProperty as a Property.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  referencer.prototype.ClassProperty = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">node</span>) </span>{
    <span class="hljs-keyword">if</span> (node.typeAnnotation) {
      visitTypeAnnotation.call(<span class="hljs-keyword">this</span>, node.typeAnnotation);
    }
    <span class="hljs-keyword">this</span>.visitProperty(node);
  };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>visit flow type in FunctionDeclaration, FunctionExpression, ArrowFunctionExpression</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> visitFunction = referencer.prototype.visitFunction;
  referencer.prototype.visitFunction = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">node</span>) </span>{
    <span class="hljs-keyword">var</span> typeParamScope;
    <span class="hljs-keyword">if</span> (node.typeParameters) {
      typeParamScope = nestTypeParamScope.call(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.scopeManager, node);
    }
    <span class="hljs-keyword">if</span> (node.returnType) {
      checkIdentifierOrVisit.call(<span class="hljs-keyword">this</span>, node.returnType);
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>only visit if function parameters have types</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (node.params) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; node.params.length; i++) {
        <span class="hljs-keyword">var</span> param = node.params[i];
        <span class="hljs-keyword">if</span> (param.typeAnnotation) {
          checkIdentifierOrVisit.call(<span class="hljs-keyword">this</span>, param);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (t.isAssignmentPattern(param)) {
          <span class="hljs-keyword">if</span> (param.left.typeAnnotation) {
            checkIdentifierOrVisit.call(<span class="hljs-keyword">this</span>, param.left);
          }
        }
      }
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>set ArrayPattern/ObjectPattern visitor keys back to their original. otherwise
escope will traverse into them and include the identifiers within as declarations</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    estraverse.VisitorKeys.ObjectPattern = [<span class="hljs-string">"properties"</span>];
    estraverse.VisitorKeys.ArrayPattern = [<span class="hljs-string">"elements"</span>];
    visitFunction.call(<span class="hljs-keyword">this</span>, node);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>set them back to normal...</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    estraverse.VisitorKeys.ObjectPattern = t.VISITOR_KEYS.ObjectPattern;
    estraverse.VisitorKeys.ArrayPattern = t.VISITOR_KEYS.ArrayPattern;
    <span class="hljs-keyword">if</span> (typeParamScope) {
      <span class="hljs-keyword">this</span>.close(node);
    }
  };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>visit flow type in VariableDeclaration</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> variableDeclaration = referencer.prototype.VariableDeclaration;
  referencer.prototype.VariableDeclaration = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">node</span>) </span>{
    <span class="hljs-keyword">if</span> (node.declarations) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; node.declarations.length; i++) {
        <span class="hljs-keyword">var</span> id = node.declarations[i].id;
        <span class="hljs-keyword">var</span> typeAnnotation = id.typeAnnotation;
        <span class="hljs-keyword">if</span> (typeAnnotation) {
          checkIdentifierOrVisit.call(<span class="hljs-keyword">this</span>, typeAnnotation);
        }
      }
    }
    variableDeclaration.call(<span class="hljs-keyword">this</span>, node);
  };

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createScopeVariable</span> (<span class="hljs-params">node, name</span>) </span>{
    <span class="hljs-keyword">this</span>.currentScope().variableScope.__define(name,
      <span class="hljs-keyword">new</span> Definition(
        <span class="hljs-string">"Variable"</span>,
        name,
        node,
        <span class="hljs-literal">null</span>,
        <span class="hljs-literal">null</span>,
        <span class="hljs-literal">null</span>
      )
    );
  }

  referencer.prototype.InterfaceDeclaration = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">node</span>) </span>{
    createScopeVariable.call(<span class="hljs-keyword">this</span>, node, node.id);
    <span class="hljs-keyword">var</span> typeParamScope;
    <span class="hljs-keyword">if</span> (node.typeParameters) {
      typeParamScope = nestTypeParamScope.call(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.scopeManager, node);
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>TODO: Handle mixins</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; node.extends.length; i++) {
      visitTypeAnnotation.call(<span class="hljs-keyword">this</span>, node.extends[i]);
    }
    visitTypeAnnotation.call(<span class="hljs-keyword">this</span>, node.body);
    <span class="hljs-keyword">if</span> (typeParamScope) {
      <span class="hljs-keyword">this</span>.close(node);
    }
  };

  referencer.prototype.TypeAlias = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">node</span>) </span>{
    createScopeVariable.call(<span class="hljs-keyword">this</span>, node, node.id);
    <span class="hljs-keyword">var</span> typeParamScope;
    <span class="hljs-keyword">if</span> (node.typeParameters) {
      typeParamScope = nestTypeParamScope.call(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.scopeManager, node);
    }
    <span class="hljs-keyword">if</span> (node.right) {
      visitTypeAnnotation.call(<span class="hljs-keyword">this</span>, node.right);
    }
    <span class="hljs-keyword">if</span> (typeParamScope) {
      <span class="hljs-keyword">this</span>.close(node);
    }
  };

  referencer.prototype.DeclareModule =
  referencer.prototype.DeclareFunction =
  referencer.prototype.DeclareVariable =
  referencer.prototype.DeclareClass = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">node</span>) </span>{
    <span class="hljs-keyword">if</span> (node.id) {
      createScopeVariable.call(<span class="hljs-keyword">this</span>, node, node.id);
    }

    <span class="hljs-keyword">var</span> typeParamScope;
    <span class="hljs-keyword">if</span> (node.typeParameters) {
      typeParamScope = nestTypeParamScope.call(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.scopeManager, node);
    }
    <span class="hljs-keyword">if</span> (typeParamScope) {
      <span class="hljs-keyword">this</span>.close(node);
    }
  };
}

exports.parse = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code, options</span>) </span>{
  options = options || {};
  eslintOptions.ecmaVersion = options.ecmaVersion = options.ecmaVersion || <span class="hljs-number">6</span>;
  eslintOptions.sourceType = options.sourceType = options.sourceType || <span class="hljs-string">"module"</span>;
  eslintOptions.allowImportExportEverywhere = options.allowImportExportEverywhere = options.allowImportExportEverywhere || <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">if</span> (options.sourceType === <span class="hljs-string">"module"</span>) {
    eslintOptions.globalReturn = <span class="hljs-literal">false</span>;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">delete</span> eslintOptions.globalReturn;
  }

  <span class="hljs-keyword">if</span> (!hasPatched) {
    hasPatched = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">try</span> {
      monkeypatch(getModules());
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-built_in">console</span>.error(err.stack);
      process.exit(<span class="hljs-number">1</span>);
    }
  }

  <span class="hljs-keyword">return</span> exports.parseNoPatch(code, options);
};

exports.parseNoPatch = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code, options</span>) </span>{
  <span class="hljs-keyword">var</span> opts = {
    <span class="hljs-attr">codeFrame</span>: options.hasOwnProperty(<span class="hljs-string">"codeFrame"</span>) ? options.codeFrame : <span class="hljs-literal">true</span>,
    <span class="hljs-attr">sourceType</span>: options.sourceType,
    <span class="hljs-attr">allowImportExportEverywhere</span>: options.allowImportExportEverywhere, <span class="hljs-comment">// consistent with espree</span>
    allowReturnOutsideFunction: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">allowSuperOutsideMethod</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">plugins</span>: [
      <span class="hljs-string">"flow"</span>,
      <span class="hljs-string">"jsx"</span>,
      <span class="hljs-string">"asyncFunctions"</span>,
      <span class="hljs-string">"asyncGenerators"</span>,
      <span class="hljs-string">"classConstructorCall"</span>,
      <span class="hljs-string">"classProperties"</span>,
      <span class="hljs-string">"decorators"</span>,
      <span class="hljs-string">"doExpressions"</span>,
      <span class="hljs-string">"exponentiationOperator"</span>,
      <span class="hljs-string">"exportExtensions"</span>,
      <span class="hljs-string">"functionBind"</span>,
      <span class="hljs-string">"functionSent"</span>,
      <span class="hljs-string">"objectRestSpread"</span>,
      <span class="hljs-string">"trailingFunctionCommas"</span>,
      <span class="hljs-string">"dynamicImport"</span>
    ]
  };

  <span class="hljs-keyword">var</span> ast;
  <span class="hljs-keyword">try</span> {
    ast = parse(code, opts);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-keyword">if</span> (err <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">SyntaxError</span>) {

      err.lineNumber = err.loc.line;
      err.column = err.loc.column;

      <span class="hljs-keyword">if</span> (opts.codeFrame) {
        err.lineNumber = err.loc.line;
        err.column = err.loc.column + <span class="hljs-number">1</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>remove trailing &quot;(LINE:COLUMN)&quot; acorn message and add in esprima syntax error message start</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        err.message = <span class="hljs-string">"Line "</span> + err.lineNumber + <span class="hljs-string">": "</span> + err.message.replace(<span class="hljs-regexp">/ \((\d+):(\d+)\)$/</span>, <span class="hljs-string">""</span>) +
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>add codeframe</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-string">"\n\n"</span> +
        codeFrame(code, err.lineNumber, err.column, { <span class="hljs-attr">highlightCode</span>: <span class="hljs-literal">true</span> });
      }
    }

    <span class="hljs-keyword">throw</span> err;
  }

  babylonToEspree(ast, traverse, tt, code);

  <span class="hljs-keyword">return</span> ast;
};

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
